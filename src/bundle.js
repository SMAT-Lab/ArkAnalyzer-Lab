import*as e from"typescript";import t from"typescript";import{configure as s,getLogger as i}from"log4js";import n from"path";import*as r from"fs";import o from"fs";import a from"source-map";var l;!function(e){e.ERROR="ERROR",e.WARN="WARN",e.INFO="INFO",e.DEBUG="DEBUG",e.TRACE="TRACE"}(l||(l={}));class h{static configure(e,t){s({appenders:{file:{type:"fileSync",filename:`${e}`,maxLogSize:5242880,backups:5,compress:!0,encoding:"utf-8",layout:{type:"pattern",pattern:"[%d] [%p] [%z] [ArkAnalyzer] - %m"}},console:{type:"console",layout:{type:"pattern",pattern:"[%d] [%p] [%z] [ArkAnalyzer] - %m"}}},categories:{default:{appenders:["console"],level:"info",enableCallStack:!1},codelinter:{appenders:["file"],level:t,enableCallStack:!0}}})}static getLogger(){return i("codelinter")}static setLogLevel(e){i("codelinter").level=e}}class c{}class d extends c{static getInstance(){return this.INSTANCE}constructor(){super()}toString(){return"any"}}d.INSTANCE=new d;class u extends c{static getInstance(){return this.INSTANCE}constructor(){super()}toString(){return"unknown"}}u.INSTANCE=new u;class g extends c{constructor(e){super(),this.name=e}getName(){return this.name}toString(){return this.name}}class p extends c{constructor(e){super(),this.name=e}getName(){return this.name}toString(){return this.name}}class f extends p{constructor(){super("boolean")}static getInstance(){return this.INSTANCE}}f.INSTANCE=new f;class m extends p{constructor(){super("number")}static getInstance(){return this.INSTANCE}}m.INSTANCE=new m;class S extends p{constructor(){super("string")}static getInstance(){return this.INSTANCE}}S.INSTANCE=new S;class k extends p{static getInstance(){return this.INSTANCE}constructor(){super("null")}}k.INSTANCE=new k;class y extends p{static getInstance(){return this.INSTANCE}constructor(){super("undefined")}}y.INSTANCE=new y;class x extends p{constructor(e){super("literal"),this.literalName=e}getliteralName(){return this.literalName}toString(){return this.getName()+": "+this.literalName}}class N extends c{constructor(e,t=u.getInstance()){super(),this.types=[...e],this.currType=t}getTypes(){return this.types}getCurrType(){return this.currType}setCurrType(e){this.currType=e}toString(){let e=this.types.join("|");return this.currType instanceof u||this.currType==this||(e+="-"+this.currType),e}}class T extends c{static getInstance(){return this.INSTANCE}constructor(){super()}toString(){return"void"}}T.INSTANCE=new T;class w extends c{static getInstance(){return this.INSTANCE}constructor(){super()}toString(){return"never"}}w.INSTANCE=new w;class C extends c{constructor(e){super(),this.methodSignature=e}getMethodSignature(){return this.methodSignature}toString(){return this.methodSignature.toString()}}class I extends c{constructor(e){super(),this.classSignature=e}getClassSignature(){return this.classSignature}setClassSignature(e){this.classSignature=e}toString(){return this.classSignature.toString()}}class F extends c{constructor(e,t){super(),this.baseType=e,this.dimension=t}getBaseType(){return this.baseType}getDimension(){return this.dimension}toString(){const e=[];e.push("("+this.baseType.toString()+")");for(let t=0;t<this.dimension;t++)e.push("[]");return e.join("")}}class A extends F{constructor(e,t){super(e,t)}toString(){return"Array<"+this.getBaseType()+">[]"}}class E extends c{constructor(e){super(),this.types=e}getTypes(){return this.types}toString(){return"["+this.types.join(", ")+"]"}}class b extends c{constructor(e){super(),this.originalType=e}getOriginalType(){return this.originalType}toString(){return"alias: "+this.originalType}}class P extends b{constructor(e){super(e)}}class D extends c{constructor(){super(),this.members=[]}getMembers(){return this.members}setMembers(e){this.members=e}addMember(e){this.members.push(e)}}class v extends c{constructor(e){super(),this.originType=e}getOriginType(){return this.originType}}class M extends v{constructor(e){super(e)}getOriginType(){return super.getOriginType()}}class O extends v{constructor(e){super(e)}getOriginType(){return super.getOriginType()}}const B=h.getLogger();class L{constructor(){this.propertyName="",this.name="",this.optional=!1,this.initializer=""}getName(){return this.name}setName(e){this.name=e}getPropertyName(){return this.propertyName}setPropertyName(e){this.propertyName=e}isOptional(){return this.optional}setOptional(e){this.optional=e}}class U{constructor(){this.propertyName="",this.name="",this.optional=!1,this.initializer=""}getName(){return this.name}setName(e){this.name=e}getPropertyName(){return this.propertyName}setPropertyName(e){this.propertyName=e}isOptional(){return this.optional}setOptional(e){this.optional=e}}class V{constructor(){this.name="",this.optional=!1,this.objElements=[],this.arrayElements=[]}getName(){return this.name}setName(e){this.name=e}getType(){return this.type}setType(e){this.type=e}isOptional(){return this.optional}setOptional(e){this.optional=e}addObjElement(e){this.objElements.push(e)}getObjElements(){return this.objElements}setObjElements(e){this.objElements=e}addArrayElement(e){this.arrayElements.push(e)}getArrayElements(){return this.arrayElements}setArrayElements(e){this.arrayElements=e}}class j{constructor(e,t,s,i,n,r){this.getAccessorName=void 0,this.name=e,this.parameters=t,this.modifiers=s,this.returnType=i,this.typeParameters=n,this.getAccessorName=r}updateName4anonymousFunc(e){this.name=e}}function R(t,s){let i,n="";e.isFunctionDeclaration(t)?n=t.name?t.name.text:"":e.isMethodDeclaration(t)||e.isMethodSignature(t)?e.isIdentifier(t.name)?n=t.name.text:e.isComputedPropertyName(t.name)?e.isPropertyAccessExpression(t.name.expression)&&(n=qe(t.name.expression)):B.warn("Other method declaration type found!"):e.isConstructorDeclaration(t)?n="constructor":e.isConstructSignatureDeclaration(t)?n="construct-signature":e.isCallSignatureDeclaration(t)?n="call-signature":e.isGetAccessor(t)&&e.isIdentifier(t.name)?(n="Get-"+t.name.text,i=t.name.text):e.isSetAccessor(t)&&e.isIdentifier(t.name)&&(n="Set-"+t.name.text);let r=Ye(t,s),o=new Set;e.isConstructSignatureDeclaration(t)||e.isCallSignatureDeclaration(t)||t.modifiers&&(o=Je(t.modifiers));let a=Ze(t,s),l=Xe(t);return new j(n,r,o,a,l,i)}class W{}class K extends W{constructor(e,t){super(),this.methodSignature=e,this.args=t}getMethodSignature(){return this.methodSignature}setMethodSignature(e){this.methodSignature=e}getArg(e){return this.args[e]}getArgs(){return this.args}setArgs(e){this.args=e}getType(){return this.methodSignature.getType()}getUses(){let e=[];e.push(...this.args);for(const t of this.args)e.push(...t.getUses());return e}}class _ extends K{constructor(e,t,s){super(t,s),this.base=e}getBase(){return this.base}setBase(e){this.base=e}getUses(){let e=[];e.push(this.base),e.push(...this.base.getUses()),e.push(...this.getArgs());for(const t of this.getArgs())e.push(...t.getUses());return e}toString(){let e=[];if(e.push("instanceinvoke "),e.push(this.base.toString()),e.push(".<"),e.push(this.getMethodSignature().toString()),e.push(">("),this.getArgs().length>0){for(const t of this.getArgs())e.push(t.toString()),e.push(", ");e.pop()}return e.push(")"),e.join("")}}class G extends K{constructor(e,t){super(e,t)}toString(){let e=[];if(e.push("staticinvoke <"),e.push(this.getMethodSignature().toString()),e.push(">("),this.getArgs().length>0){for(const t of this.getArgs())e.push(t.toString()),e.push(", ");e.pop()}return e.push(")"),e.join("")}}class z extends W{constructor(e){super(),this.classType=e}getUses(){return[]}getType(){return this.classType}toString(){return"new "+this.classType}}class $ extends W{constructor(e,t){super(),this.baseType=e,this.size=t}getSize(){return this.size}setSize(e){this.size=e}getType(){return new F(this.baseType,1)}getBaseType(){return this.baseType}setBaseType(e){this.baseType=e}getUses(){let e=[this.size];return e.push(...this.size.getUses()),e}toString(){return"newarray ("+this.baseType+")["+this.size+"]"}}class H extends W{constructor(e,t,s){super(),this.op1=e,this.op2=t,this.operator=s}getOp1(){return this.op1}setOp1(e){this.op1=e}getOp2(){return this.op2}setOp2(e){this.op2=e}getOperator(){return this.operator}getType(){return ze.inferTypeOfBinopExpr(this)}getUses(){let e=[];return e.push(this.op1),e.push(...this.op1.getUses()),e.push(this.op2),e.push(...this.op2.getUses()),e}toString(){return this.op1+" "+this.operator+" "+this.op2}}class Q extends H{constructor(e,t,s){super(e,t,s)}}class q extends W{constructor(e){super(),this.op=e}getOp(){return this.op}setOp(e){this.op=e}getUses(){let e=[];return e.push(this.op),e.push(...this.op.getUses()),e}getType(){return this.op.getType()}toString(){return"typeof "+this.op}}class J extends W{constructor(e,t){super(),this.op=e,this.checkType=t}getOp(){return this.op}setOp(e){this.op=e}getType(){return f.getInstance()}getUses(){let e=[];return e.push(this.op),e.push(...this.op.getUses()),e}toString(){return this.op+" instanceof "+this.checkType}}class X extends W{constructor(e){super(),this.op=e}getOp(){return this.op}setOp(e){this.op=e}getType(){return m.getInstance()}getUses(){let e=[];return e.push(this.op),e.push(...this.op.getUses()),e}toString(){return"lengthof "+this.op}}class Y extends W{constructor(e,t){super(),this.op=e,this.type=t}getOp(){return this.op}setOp(e){this.op=e}getUses(){let e=[];return e.push(this.op),e.push(...this.op.getUses()),e}getType(){return this.type}toString(){return"<"+this.type+">"+this.op}}class Z extends W{constructor(){super(),this.args=[],this.blockToArg=new Map,this.argToBlock=new Map}getUses(){let e=[];return e.push(...this.args),e}getArgs(){return this.args}setArgs(e){this.args=e}getArgToBlock(){return this.argToBlock}setArgToBlock(e){this.argToBlock=e}getType(){return this.args[0].getType()}toString(){let e=[];if(e.push("phi("),this.args.length>0){for(const t of this.args)e.push(t.toString()),e.push(", ");e.pop()}return e.push(")"),e.join("")}}class ee extends W{constructor(e,t){super(),this.op=e,this.operator=t}getUses(){let e=[];return e.push(this.op),e.push(...this.op.getUses()),e}getType(){return this.op.getType()}getOperator(){return this.operator}toString(){return this.operator+this.op}}class te{constructor(e,t=u.getInstance()){this.name=e,this.type=t,this.originalValue=null,this.declaringStmt=null,this.usedStmts=[]}getName(){return this.name}setName(e){this.name=e}getType(){return this.type}setType(e){this.type=e}getOriginalValue(){return this.originalValue}setOriginalValue(e){this.originalValue=e}getDeclaringStmt(){return this.declaringStmt}setDeclaringStmt(e){this.declaringStmt=e}getUses(){return[]}addUsedStmt(e){this.usedStmts.push(e)}getUsedStmts(){return this.usedStmts}toString(){return this.getName()}}const se=h.getLogger();class ie{}class ne extends ie{constructor(e,t){super(),this.base=e,this.index=t}getBase(){return this.base}setBase(e){this.base=e}getIndex(){return this.index}setIndex(e){this.index=e}getType(){const e=this.base.getType();return e instanceof F?e.getBaseType():(se.warn("the type of base in ArrayRef is not ArrayType"),u.getInstance())}getUses(){let e=[];return e.push(this.base),e.push(...this.base.getUses()),e.push(this.index),e.push(...this.index.getUses()),e}toString(){return this.base+"["+this.index+"]"}}class re extends ie{constructor(e){super(),this.fieldSignature=e}getFieldName(){return this.fieldSignature.getFieldName()}getFieldSignature(){return this.fieldSignature}setFieldSignature(e){this.fieldSignature=e}getType(){return this.fieldSignature.getType()}}class oe extends re{constructor(e,t){super(t),this.base=e}getBase(){return this.base}setBase(e){this.base=e}getUses(){let e=[];return e.push(this.base),e.push(...this.base.getUses()),e}toString(){return this.base.toString()+".<"+this.getFieldSignature()+">"}}class ae extends re{constructor(e){super(e)}getUses(){return[]}toString(){return this.getFieldSignature().toString()}}class le extends ie{constructor(e,t){super(),this.index=e,this.paramType=t}getIndex(){return this.index}getType(){return this.paramType}getUses(){return[]}toString(){return"parameter"+this.index+": "+this.paramType}}class he extends ie{constructor(e){super(),this.type=e}getType(){return this.type}getUses(){return[]}toString(){return"this: "+this.type}}class ce extends ie{constructor(e){super(),this.type=e}getType(){return this.type}getUses(){return[]}toString(){return"caughtexception: "+this.type}}function de(e,t,s,i){return new(s||(s=Promise))((function(n,r){function o(e){try{l(i.next(e))}catch(e){r(e)}}function a(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,a)}l((i=i.apply(e,t||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;class ue{constructor(e,t){this.oldUse=e,this.newUse=t}caseExpr(e){e instanceof H?this.caseBinopExp(e):e instanceof K?this.caseInvokeExpr(e):e instanceof $?this.caseNewArrayExpr(e):e instanceof H?this.caseBinopExpr(e):e instanceof q?this.caseTypeOfExpr(e):e instanceof J?this.caseInstanceOfExpr(e):e instanceof X?this.caseLengthExpr(e):e instanceof Y&&this.caseCastExpr(e)}caseBinopExp(e){e.getOp1()==this.oldUse&&e.setOp1(this.newUse),e.getOp2()==this.oldUse&&e.setOp2(this.newUse)}caseInvokeExpr(e){let t=e.getArgs();for(let e=0;e<t.length;e++)t[e]==this.oldUse&&(t[e]=this.newUse);e instanceof _&&e.getBase()==this.oldUse&&e.setBase(this.newUse)}caseNewArrayExpr(e){e.getSize()==this.oldUse&&e.setSize(this.newUse)}caseBinopExpr(e){e.getOp1()==this.oldUse&&e.setOp1(this.newUse),e.getOp2()==this.oldUse&&e.setOp2(this.newUse)}caseTypeOfExpr(e){e.getOp()==this.oldUse&&e.setOp(this.newUse)}caseInstanceOfExpr(e){e.getOp()==this.oldUse&&e.setOp(this.newUse)}caseLengthExpr(e){e.getOp()==this.oldUse&&e.setOp(this.newUse)}caseCastExpr(e){e.getOp()==this.oldUse&&e.setOp(this.newUse)}}class ge{constructor(e,t){this.oldUse=e,this.newUse=t}caseRef(e){e instanceof oe?this.caseFieldRef(e):e instanceof ne&&this.caseArrayRef(e)}caseFieldRef(e){e.getBase()==this.oldUse&&e.setBase(this.newUse)}caseArrayRef(e){e.getBase()==this.oldUse?e.setBase(this.newUse):e.getIndex()==this.oldUse&&e.setIndex(this.newUse)}}class pe{constructor(e,t){this.oldUse=e,this.newUse=t}caseStmt(e){e instanceof ye?this.caseAssignStmt(e):e instanceof xe?this.caseInvokeStmt(e):e instanceof we?this.caseReturnStmt(e):e instanceof Ne&&this.caseIfStmt(e)}caseAssignStmt(e){let t=e.getRightOp();if(t==this.oldUse)e.setRightOp(this.newUse);else if(t instanceof te)t==this.oldUse&&e.setRightOp(this.newUse);else if(t instanceof ie)if(t==this.oldUse)e.setRightOp(this.newUse);else{new ge(this.oldUse,this.newUse).caseRef(t)}else if(t instanceof W)if(t==this.oldUse)e.setRightOp(this.newUse);else{new ue(this.oldUse,this.newUse).caseExpr(t)}}caseInvokeStmt(e){new ue(this.oldUse,this.newUse).caseExpr(e.getInvokeExpr())}caseReturnStmt(e){e.setReturnValue(this.newUse)}caseIfStmt(e){new ue(this.oldUse,this.newUse).caseExpr(e.getConditionExprExpr())}}class fe{}class me{constructor(e){this.lineNo=e}getLineNo(){return this.lineNo}}class Se{constructor(e,t){this.lineNo=e,this.colNo=t}getLineNo(){return this.lineNo}getColNo(){return this.colNo}static buildFromNode(e,s){let{line:i,character:n}=t.getLineAndCharacterOfPosition(s,e.getStart(s));return new Se(i+1,n)}}class ke{constructor(){this.text="",this.def=null,this.uses=[],this.originPosition=0,this.position=0,this.valueVersion=new Map,this.valueTags=new Map,this.cfg=null,this.originColumn=-1,this.column=-1}getUses(){let e=[];for(const t of this.uses)t instanceof W||e.push(t);return e}addUse(e){this.uses.push(e)}replaceUse(e,t){new pe(e,t).caseStmt(this)}replaceUses(e){this.uses=Array.from(e)}getDef(){return this.def}setDef(e){this.def=e}getValueVersion(e){return this.valueVersion.get(e)}setValueVersion(e,t){}getValueTags(e){return this.valueTags.get(e)}setValueTag(e,t){var s;null===(s=this.valueTags.get(e))||void 0===s||s.add(t)}getCfg(){return this.cfg}setCfg(e){this.cfg=e}isBranch(){return!1}getExpectedSuccessorCount(){return 1}containsInvokeExpr(){for(const e of this.uses)if(e instanceof K)return!0;return!1}replaceInvokeExpr(e){for(let t=0;t<this.uses.length;t++)this.uses[t]instanceof K&&(this.uses[t]=e)}getInvokeExpr(){for(const e of this.uses)if(e instanceof K)return e}getExprs(){let e=[];for(const t of this.uses)t instanceof W&&e.push(t);return e}containsArrayRef(){for(const e of this.uses)if(e instanceof ne)return!0;return this.def instanceof ne}getArrayRef(){for(const e of this.uses)if(e instanceof ne)return e;this.def}containsFieldRef(){for(const e of this.uses)if(e instanceof re)return!0;return this.def instanceof re}getFieldRef(){for(const e of this.uses)if(e instanceof re)return e;this.def}setPositionInfo(e){this.position=e}getPositionInfo(){return this.position}setOriginPositionInfo(e){this.originPosition=e}getOriginPositionInfo(){return this.originPosition}setEtsPositionInfo(e){this.etsPosition=e}getEtsPositionInfo(e){return de(this,void 0,void 0,(function*(){if(!this.etsPosition){const t=yield e.getEtsOriginalPositionFor(new Se(this.originPosition,this.originColumn));this.setEtsPositionInfo(t)}return this.etsPosition}))}setColumn(e){this.column=e}getColumn(){return this.column}setOriginColumn(e){this.originColumn=e}getOriginColumn(){return this.originColumn}toString(){return this.text}setText(e){this.text=e}}class ye extends ke{constructor(e,t){super(),this.leftOp=e,this.rightOp=t,this.setDef(e),this.updateUses()}getLeftOp(){return this.leftOp}setLeftOp(e){this.leftOp=e,this.setDef(e)}getRightOp(){return this.rightOp}setRightOp(e){this.rightOp=e,this.updateUses()}toString(){const e=this.getLeftOp()+" = "+this.getRightOp();return this.setText(e),e}updateUses(){let e=[];e.push(...this.leftOp.getUses()),e.push(this.rightOp),e.push(...this.rightOp.getUses()),this.replaceUses(e)}}class xe extends ke{constructor(e){super(),this.invokeExpr=e,this.updateUses()}replaceInvokeExpr(e){this.invokeExpr=e,this.updateUses()}getInvokeExpr(){return this.invokeExpr}toString(){const e=this.invokeExpr.toString();return this.setText(e),e}updateUses(){let e=[];e.push(this.invokeExpr),e.push(...this.invokeExpr.getUses()),this.replaceUses(e)}}class Ne extends ke{constructor(e){super(),this.conditionExpr=e,this.updateUses()}getConditionExprExpr(){return this.conditionExpr}isBranch(){return!0}getExpectedSuccessorCount(){return 2}toString(){const e="if "+this.conditionExpr;return this.setText(e),e}updateUses(){let e=[];e.push(this.conditionExpr),e.push(...this.conditionExpr.getUses()),this.replaceUses(e)}}class Te extends ke{constructor(){super()}isBranch(){return!0}toString(){const e="goto";return this.setText(e),e}}class we extends ke{constructor(e){super(),this.op=e,this.updateUses()}getExpectedSuccessorCount(){return 0}getOp(){return this.op}setReturnValue(e){this.op=e,this.updateUses()}toString(){const e="return "+this.op;return this.setText(e),e}updateUses(){let e=[];e.push(this.op),e.push(...this.op.getUses()),this.replaceUses(e)}}class Ce extends ke{constructor(){super()}getExpectedSuccessorCount(){return 0}toString(){const e="return";return this.setText(e),e}}class Ie extends ke{constructor(){super()}toString(){return this.setText("nop"),"nop"}}class Fe extends ke{constructor(e,t){super(),this.key=e,this.cases=t,this.updateUses()}getKey(){return this.key}getCases(){return this.cases}isBranch(){return!0}getExpectedSuccessorCount(){return this.cases.length+1}toString(){let e=[];e.push("switch("+this.key+") {");for(const t of this.cases)e.push("case "),e.push(t.toString()),e.push(": "),e.push(", ");e.push("default : }");const t=e.join("");return this.setText(t),t}updateUses(){let e=[];e.push(this.key),e.push(...this.key.getUses()),this.replaceUses(e)}}class Ae extends ke{constructor(e){super(),this.field=e,this.updateUses()}getField(){return this.field}setField(e){this.field=e}toString(){const e="delete "+this.field;return this.setText(e),e}updateUses(){let e=[];e.push(this.field),e.push(...this.field.getUses()),this.replaceUses(e)}}class Ee extends ke{constructor(e){super(),this.op=e,this.updateUses()}getOp(){return this.op}toString(){const e="throw "+this.op;return this.setText(e),e}updateUses(){let e=[];e.push(this.op),e.push(...this.op.getUses()),this.replaceUses(e)}}function be(e){return n.posix.join(...e.split(/\\/))}class Pe{constructor(){this.projectName="_UnkownProjectName",this.fileName="_UnkownFileName"}getProjectName(){return this.projectName}setProjectName(e){this.projectName=e}getFileName(){return this.fileName}setFileName(e){this.fileName=e}toString(){let e=be(this.fileName);return e=e.replace(/\.d\.ts|\.ts$/,""),e="@"+this.projectName+"/"+e+": ",e}}class De{constructor(){this.namespaceName="",this.declaringFileSignature=new Pe,this.declaringNamespaceSignature=null}getNamespaceName(){return this.namespaceName}setNamespaceName(e){this.namespaceName=e}getDeclaringFileSignature(){return this.declaringFileSignature}setDeclaringFileSignature(e){this.declaringFileSignature=e}getDeclaringNamespaceSignature(){return this.declaringNamespaceSignature}setDeclaringNamespaceSignature(e){this.declaringNamespaceSignature=e}toString(){return this.declaringNamespaceSignature?this.declaringNamespaceSignature.toString()+"."+this.namespaceName:this.declaringFileSignature.toString()+this.namespaceName}}class ve{getDeclaringFileSignature(){return this.declaringFileSignature}setDeclaringFileSignature(e){this.declaringFileSignature=e}getDeclaringNamespaceSignature(){return this.declaringNamespaceSignature}setDeclaringNamespaceSignature(e){this.declaringNamespaceSignature=e}getClassName(){return this.className}setClassName(e){this.className=e}getType(){return new I(this)}constructor(){this.declaringFileSignature=new Pe,this.declaringNamespaceSignature=null,this.className=""}toString(){return this.declaringNamespaceSignature?this.declaringNamespaceSignature.toString()+"."+this.className:this.declaringFileSignature.toString()+this.className}}class Me{getDeclaringClassSignature(){return this.declaringClassSignature}setDeclaringClassSignature(e){this.declaringClassSignature=e}getFieldName(){return this.fieldName}setFieldName(e){this.fieldName=e}setType(e){this.type=e}getType(){return this.type}constructor(){this.declaringClassSignature=new ve,this.fieldName="",this.type=u.getInstance()}toString(){return this.getDeclaringClassSignature().toString()+"."+this.getFieldName()}}class Oe{getMethodName(){return this.methodName}setMethodName(e){this.methodName=e}getParameters(){return this.parameters}getParameterTypes(){return this.parameterTypes}setParameters(e){this.parameters=e,e.forEach(((e,t)=>{this.parameterTypes.add(e)}))}getReturnType(){return this.returnType}setReturnType(e){this.returnType=e}constructor(){this.methodName="",this.parameters=[],this.parameterTypes=new Set,this.returnType=u.getInstance()}toString(){let e="";return this.parameterTypes.forEach((t=>{e=e+t+", "})),e=e.replace(/, $/,""),`${this.getMethodName()}(${e})`}}class Be{getDeclaringClassSignature(){return this.declaringClassSignature}setDeclaringClassSignature(e){this.declaringClassSignature=e}getMethodSubSignature(){return this.methodSubSignature}setMethodSubSignature(e){this.methodSubSignature=e}getType(){return this.methodSubSignature.getReturnType()}constructor(){this.declaringClassSignature=new ve,this.methodSubSignature=new Oe}toString(){return this.declaringClassSignature.toString()+"."+this.methodSubSignature.toString()}}class Le{getArkFile(){return this.arkFile}setArkFile(e){this.arkFile=e}getInterfaceName(){return this.interfaceName}setInterfaceName(e){this.interfaceName=e}constructor(){this.arkFile="",this.interfaceName="",this.arkFileWithoutExt=""}build(e,t){this.setArkFile(e),this.setInterfaceName(t),this.arkFileWithoutExt=n.dirname(e)+"/"+n.basename(e,n.extname(e))}toString(){return`<${this.getArkFile()}>.<#Interface#>.<${this.getInterfaceName()}>`}}function Ue(e,t){return!(!Re(e.getDeclaringClassSignature(),t.getDeclaringClassSignature())||e.getFieldName()!=t.getFieldName())}function Ve(e,t){return!(!Re(e.getDeclaringClassSignature(),t.getDeclaringClassSignature())||!je(e.getMethodSubSignature(),t.getMethodSubSignature()))}function je(e,t){return!(e.getMethodName()!=t.getMethodName()||!function(e,t){const s=Array.from(e),i=Array.from(t);return function(e,t){if(e.length!=t.length)return!1;for(let s=0;s<e.length;s++)if(e[s]!=t[s])return!1;return!0}(s,i)}(e.getParameterTypes(),t.getParameterTypes())||e.getReturnType()!=t.getReturnType())}function Re(e,t){return!(!We(e.getDeclaringFileSignature(),t.getDeclaringFileSignature())||e.getClassName()!=t.getClassName())}function We(e,t){return e.getFileName()==t.getFileName()&&e.getProjectName()==t.getProjectName()}function Ke(e,t){return`<${e}>.<${t}>`}class _e{static getMethodSignatureFromArkClass(e,t){for(const s of e.getMethods())if(s.getName()==t)return s.getSignature();return null}static getClassWithClassSignature(e,t){const s=e.getDeclaringFileSignature();let i=t.getFile(s);if(i||(i=t.getSdkArkFilestMap().get(s.toString())||null),null==i)return null;let n=e.getDeclaringNamespaceSignature(),r=[];for(;null!=n;)r.push(n),n=n.getDeclaringNamespaceSignature();let o=i;for(let e=r.length-1;e>=0;e--)if(o=o.getNamespace(r[e]),null==o)return null;return o.getClass(e)}static getMethodWithMethodSignature(e,t){return this.getClassWithClassSignature(e.getDeclaringClassSignature(),t).getMethod(e)}static getClassWithNameInNamespaceRecursively(e,t){if(""==e)return null;let s=null;if(s=this.getClassInNamespaceWithName(e,t),null==s){let i=t.getDeclaringArkNamespace();s=null!=i?this.getClassWithNameInNamespaceRecursively(e,i):this.getClassInFileWithName(e,t.getDeclaringArkFile())}return s}static getClassWithNameFromClass(e,t){if(!e.includes(".")){let s=null;return s=null!=t.getDeclaringArkNamespace()?this.getClassWithNameInNamespaceRecursively(e,t.getDeclaringArkNamespace()):this.getClassInFileWithName(e,t.getDeclaringArkFile()),s}{const s=e.split(".");let i=this.getNamespaceWithNameFromClass(s[0],t);for(let e=1;e<s.length-1;e++)i&&(i=this.getNamespaceInNamespaceWithName(s[e],i));if(i)return this.getClassInNamespaceWithName(s[s.length-1],i)}return null}static getClassWithName(e,t){if(!e.includes(".")){const s=t.getDeclaringArkClass();if(s.getName()==e)return s;const i=s.getDeclaringArkNamespace();let n=null;if(i&&(n=this.getClassInNamespaceWithName(e,i),n))return n;const r=s.getDeclaringArkFile();return n=this.getClassInFileWithName(e,r),n}{const s=e.split(".");let i=this.getNamespaceWithName(s[0],t);for(let e=1;e<s.length-1;e++)i&&(i=this.getNamespaceInNamespaceWithName(s[e],i));if(i)return this.getClassInNamespaceWithName(s[s.length-1],i)}return null}static getClassInNamespaceWithName(e,t){for(const s of t.getClasses())if(s.getName()==e)return s;return null}static getClassInFileWithName(e,t){for(const s of t.getClasses())if(s.getName()==e)return s;return this.getClassInImportInfoWithName(e,t)}static getClassInImportInfoWithName(e,t){for(const s of t.getImportInfos())if(s.getImportClauseName()==e){const i=this.getFileFromImportInfo(s,t.getScene());if(i){const t=s.getNameBeforeAs();return null!=t&&(e=t),this.getClassInImportFileWithName(e,i)}}return null}static getClassInImportFileWithName(e,t){let s=null;for(const i of t.getExportInfos()){if(i.getExportClauseName()==e){const s=i.getNameBeforeAs();null!=s&&(e=s);for(const s of t.getClasses())if(s.getName()==e)return s;return this.getClassInImportInfoWithName(e,t)}i.getDefault()&&(s=i)}if(s){e=s.getExportClauseName();for(const s of t.getClasses())if(s.getName()==e)return s;return this.getClassInImportInfoWithName(e,t)}return null}static getFileFromImportInfo(e,t){const s=e.getImportFromSignature2Str();let i=null;return"TargetProject"==e.getImportProjectType()?i=t.getFiles().find((e=>e.getFileSignature().toString()==s))||null:"SDKProject"==e.getImportProjectType()&&(i=t.getSdkArkFilestMap().get(s)||null),i}static getMethodWithName(e,t){if(t.getName()==e)return t;const s=t.getDeclaringArkClass();let i=this.getMethodInClassWithName(e,s);return i||null}static getMethodInClassWithName(e,t){for(const s of t.getMethods())if(s.getName()==e)return s;return null}static getFieldInClassWithName(e,t){for(const s of t.getFields())if(s.getName()==e)return s;return null}static getNamespaceWithNameFromClass(e,t){const s=t.getDeclaringArkNamespace();let i=null;if(s&&(i=this.getNamespaceInNamespaceWithName(e,s),i))return i;const n=t.getDeclaringArkFile();return i=this.getNamespaceInFileWithName(e,n),i}static getNamespaceWithName(e,t){const s=t.getDeclaringArkClass(),i=s.getDeclaringArkNamespace();let n=null;if(i&&(n=this.getNamespaceInNamespaceWithName(e,i),n))return n;const r=s.getDeclaringArkFile();return n=this.getNamespaceInFileWithName(e,r),n}static getNamespaceInNamespaceWithName(e,t){for(const s of t.getNamespaces())if(s.getName()==e)return s;return null}static getNamespaceInFileWithName(e,t){for(const s of t.getNamespaces())if(s.getName()==e)return s;return this.getNamespaceInImportInfoWithName(e,t)}static getNamespaceInImportInfoWithName(e,t){for(const s of t.getImportInfos())if(s.getImportClauseName()==e){const i=this.getFileFromImportInfo(s,t.getScene());if(i){const t=s.getNameBeforeAs();return null!=t&&(e=t),this.getNamespaceInImportFileWithName(e,i)}}return null}static getNamespaceInImportFileWithName(e,t){let s=null;for(const i of t.getExportInfos()){if(i.getExportClauseName()==e){const s=i.getNameBeforeAs();null!=s&&(e=s);for(const s of t.getNamespaces())if(s.getName()==e)return s;return this.getNamespaceInImportInfoWithName(e,t)}i.getDefault()&&(s=i)}if(s){e=s.getExportClauseName();for(const s of t.getNamespaces())if(s.getName()==e)return s;return this.getNamespaceInImportInfoWithName(e,t)}return null}static getStaticMethodWithName(e,t){const s=t.getDeclaringArkClass().getDeclaringArkNamespace();if(s){const t=s.getClasses().find((e=>"_DEFAULT_ARK_CLASS"==e.getName()))||null;if(t){const s=this.getMethodInClassWithName(e,t);if(s)return s}}return this.getStaticMethodInFileWithName(e,t.getDeclaringArkFile())}static getStaticMethodInFileWithName(e,t){const s=t.getClasses().find((e=>"_DEFAULT_ARK_CLASS"==e.getName()))||null;if(s){let t=this.getMethodInClassWithName(e,s);if(t)return t}return this.getStaticMethodInImportInfoWithName(e,t)}static getStaticMethodInImportInfoWithName(e,t){for(const s of t.getImportInfos())if(s.getImportClauseName()==e){const i=this.getFileFromImportInfo(s,t.getScene());if(i){const t=s.getNameBeforeAs();return null!=t&&(e=t),this.getStaticMethodInImportFileWithName(e,i)}}return null}static getStaticMethodInImportFileWithName(e,t){let s=null;for(const i of t.getExportInfos())if(i.getExportClauseName()==e){const s=t.getClasses().find((e=>"_DEFAULT_ARK_CLASS"==e.getName()))||null;if(s){const n=i.getNameBeforeAs();null!=n&&(e=n);for(const t of s.getMethods())if(t.getName()==e)return t;return this.getStaticMethodInImportInfoWithName(e,t)}}else i.getDefault()&&(s=i);if(s){e=s.getExportClauseName();const i=t.getClasses().find((e=>"_DEFAULT_ARK_CLASS"==e.getName()))||null;if(i){for(const t of i.getMethods())if(t.getName()==e)return t;return this.getStaticMethodInImportInfoWithName(e,t)}}return null}}const Ge=h.getLogger();class ze{constructor(e){this.scene=e}inferTypeInMethod(e){const t=e.getBody();if(!t)return void Ge.warn("empty body");const s=t.getCfg();for(const t of s.getBlocks())for(const s of t.getStmts())this.resolveSymbolInStmt(s,e),ze.inferTypeInStmt(s,e)}inferSimpleTypeInMethod(e){const t=e.getBody();if(!t)return void Ge.warn("empty body");const s=t.getCfg();for(const e of s.getBlocks())for(const t of e.getStmts())ze.inferSimpleTypeInStmt(t)}resolveSymbolInStmt(e,t){const s=e.getExprs();for(const i of s)if(i instanceof z){let e=i.getType();const s=e.getClassSignature().getClassName(),n=_e.getClassWithName(s,t);n&&e.setClassSignature(n.getSignature())}else if(i instanceof _){const s=i.getBase();let n=s.getType();if(n instanceof u){const r=_e.getClassWithName(s.getName(),t);if(r)n=new I(r.getSignature()),s.setType(n);else{const n=_e.getNamespaceWithName(s.getName(),t);if(n){const t=i.getMethodSignature().getMethodSubSignature().getMethodName(),s=n.getClasses().find((e=>"_DEFAULT_ARK_CLASS"==e.getName()))||null,r=_e.getMethodInClassWithName(t,s);if(r){let t=new G(r.getSignature(),i.getArgs());return void(e.containsInvokeExpr()&&(e instanceof ye&&e.getRightOp()instanceof _?e.setRightOp(t):e instanceof xe&&e.replaceInvokeExpr(t),e.setText(e.toString().replace(/^instanceInvoke/,"staticinvoke"))))}}}}if(!(n instanceof I)){Ge.warn(`type of base must be ClassType expr: ${i.toString()}`);continue}const r=_e.getClassWithClassSignature(n.getClassSignature(),this.scene);if(null==r){Ge.warn(`class ${n.getClassSignature().getClassName()} does not exist`);continue}const o=i.getMethodSignature().getMethodSubSignature().getMethodName(),a=_e.getMethodInClassWithName(o,r);if(null==a){Ge.warn(`method ${o} does not exist`);continue}if(i.setMethodSignature(a.getSignature()),a.getModifiers().has("StaticKeyword")){let t=new G(a.getSignature(),i.getArgs());e.containsInvokeExpr()&&(e.replaceInvokeExpr(t),e instanceof ye&&e.getRightOp()instanceof _?e.setRightOp(t):e instanceof xe&&e.replaceInvokeExpr(t),e.setText(e.toString().replace(/^instanceInvoke/,"staticinvoke")))}}else if(i instanceof G){const e=i.getMethodSignature().getMethodSubSignature().getMethodName(),s=_e.getStaticMethodWithName(e,t);if(null==s){Ge.warn(`method ${e} does not exist`);continue}i.setMethodSignature(s.getSignature())}for(const t of e.getUses())t instanceof oe&&this.handleClassField(t);const i=e.getDef();i&&i instanceof oe&&this.handleClassField(i)}handleClassField(e){const t=e.getBase().getType();if(!(t instanceof I))return void Ge.warn("type of base must be ClassType");const s=_e.getClassWithClassSignature(t.getClassSignature(),this.scene);if(null==s)return void Ge.warn(`class ${t.getClassSignature().getClassName()} does not exist`);const i=e.getFieldName(),n=_e.getFieldInClassWithName(i,s);null!=n?e.setFieldSignature(n.getSignature()):Ge.warn(`field ${i} does not exist`)}static inferTypeInStmt(e,t){var s,i;if(e instanceof ye){const n=e.getLeftOp();if(n instanceof te){const r=n.getType();if(r instanceof v){if(null===t)return;let i=r.getOriginType();if(r instanceof M){let r=null===(s=_e.getClassWithName(i,t))||void 0===s?void 0:s.getSignature();void 0===r?n.setType(e.getRightOp().getType()):n.setType(new I(r))}}else if(r instanceof u){const s=e.getRightOp();if(s instanceof le){let r=s.getType();if(r instanceof g){if(null==t)return;let s=null===(i=_e.getClassWithName(r.getName(),t))||void 0===i?void 0:i.getSignature();void 0===s?n.setType(e.getRightOp().getType()):n.setType(new I(s))}}else if(s instanceof oe){if(null==t)return;if(!(s.getBase().getType()instanceof I)){const e=s.getBase().getName(),i=_e.getNamespaceWithName(e,t),r=_e.getClassInNamespaceWithName(s.getFieldSignature().getFieldName(),i);return void n.setType(new I(r.getSignature()))}const e=s.getBase().getType();let i=_e.getClassWithClassSignature(e.getClassSignature(),t.getDeclaringArkFile().getScene());if(null==i)return void Ge.warn("getting Class Instance: "+s.getBase().getName());let r=_e.getFieldInClassWithName(s.getFieldName(),i);if(null==r)return void Ge.warn("getting Field Instance error: "+s.getFieldName());let o=r.getType();if(o instanceof g){const e=o.getName(),s=_e.getClassWithName(e,t);s&&(o=new I(s.getSignature()))}n.setType(o)}else if(s instanceof K){if(null===t)return;let s=e.getInvokeExpr().getMethodSignature();const i=_e.getClassWithClassSignature(s.getDeclaringClassSignature(),t.getDeclaringArkFile().getScene());if(null==i)return;const r=_e.getMethodInClassWithName(null==s?void 0:s.getMethodSubSignature().getMethodName(),i);if(null==r)return;let o=r.getReturnType();if(o instanceof g){let e=_e.getClassWithName(o.getName(),r);if(null==e)return void Ge.error("can not get method return value type: "+r.getSignature().toString()+": "+o.getName());n.setType(new I(e.getSignature()))}else n.setType(o)}else n.setType(s.getType())}else if(r instanceof N){const t=e.getRightOp();r.setCurrType(t.getType())}else r instanceof g&&e.containsInvokeExpr()}}}static inferSimpleTypeInStmt(e){if(e instanceof ye){const t=e.getLeftOp();if(t instanceof te){if(t.getType()instanceof u){const s=e.getRightOp();t.setType(s.getType())}}}}static buildTypeFromStr(e){switch(e){case"boolean":return f.getInstance();case"number":return m.getInstance();case"string":return S.getInstance();case"undefined":return y.getInstance();case"null":return k.getInstance();case"any":return d.getInstance();case"void":return T.getInstance();case"never":return w.getInstance();case"RegularExpression":const e=new ve;return e.setClassName("RegExp"),new I(e);default:return u.getInstance()}}static inferTypeOfBinopExpr(e){const t=e.getOperator();let s=e.getOp1().getType(),i=e.getOp2().getType();switch(s instanceof N&&(s=s.getCurrType()),i instanceof N&&(i=i.getCurrType()),t){case"+":if(s===S.getInstance()||i===S.getInstance())return S.getInstance();if(s===m.getInstance()&&i===m.getInstance())return m.getInstance();break;case"-":case"*":case"/":case"%":case"&":case"|":case"^":case"<<":case">>":case">>>":if(s===m.getInstance()&&i===m.getInstance())return m.getInstance();break;case"<":case"<=":case">":case">=":case"==":case"!=":case"===":case"!==":case"&&":case"||":return f.getInstance()}return u.getInstance()}}class $e{constructor(){this.name="",this.code="",this.fieldType="",this.parameters=[],this.typeParameters=[],this.modifiers=new Set,this.questionToken=!1,this.exclamationToken=!1}getDeclaringClass(){return this.declaringClass}setDeclaringClass(e){this.declaringClass=e}getCode(){return this.code}setCode(e){this.code=e}getFieldType(){return this.fieldType}setFieldType(e){this.fieldType=e}getName(){return this.name}setName(e){this.name=e}getType(){return this.type}setType(e){this.type=e}getParameters(){return this.parameters}setParameters(e){this.parameters=e}addParameter(e){this.typeParameters.push(e)}getTypeParameters(){return this.typeParameters}setTypeParameters(e){this.typeParameters=e}addTypeParameters(e){this.typeParameters.push(e)}getModifiers(){return this.modifiers}addModifier(e){this.modifiers.add(e)}getSignature(){return this.fieldSignature}setSignature(e){this.fieldSignature=e}genSignature(){let e=new Me;e.setType(this.type),e.setDeclaringClassSignature(this.declaringClass.getSignature()),e.setFieldName(this.name),this.setSignature(e)}isStatic(){return!!this.modifiers.has("StaticKeyword")}isProtected(){return!!this.modifiers.has("ProtectedKeyword")}isPrivate(){return!!this.modifiers.has("PrivateKeyword")}isPublic(){return!!this.modifiers.has("PublicKeyword")}isReadonly(){return!!this.modifiers.has("ReadonlyKeyword")}setQuestionToken(e){this.questionToken=e}setExclamationToken(e){this.exclamationToken=e}getQuestionToken(){return this.questionToken}getExclamationToken(){return this.exclamationToken}setOriginPosition(e){this.originPosition=e}getOriginPosition(){return this.originPosition}setEtsPositionInfo(e){this.etsPosition=e}getEtsPositionInfo(){return de(this,void 0,void 0,(function*(){if(!this.etsPosition){let e=this.declaringClass.getDeclaringArkFile();const t=yield e.getEtsOriginalPositionFor(this.originPosition);this.setEtsPositionInfo(t)}return this.etsPosition}))}setArkMethodSignature(e){this.arkMethodSignature=e}getArkMethodSignature(){return this.arkMethodSignature}}const He=h.getLogger();function Qe(e){let s=e.right.text,i="";return"Identifier"==t.SyntaxKind[e.left.kind]?i=e.left.text:"QualifiedName"==t.SyntaxKind[e.left.kind]&&(i=Qe(e.left)),i+"."+s}function qe(e){let s=e.name.text,i="";return"Identifier"==t.SyntaxKind[e.expression.kind]||t.isStringLiteral(e.expression)?i=e.expression.text:t.isPropertyAccessExpression(e.expression)&&(i=qe(e.expression)),i+"."+s}function Je(e){let s=new Set;return e.forEach((e=>{"FirstContextualKeyword"==t.SyntaxKind[e.kind]?s.add("AbstractKeyword"):t.isDecorator(e)?e.expression&&(t.isIdentifier(e.expression)?s.add(e.expression.text):t.isCallExpression(e.expression)&&t.isIdentifier(e.expression.expression)&&s.add(e.expression.expression.text)):s.add(t.SyntaxKind[e.kind])})),s}function Xe(e){var s;let i=[];return null===(s=e.typeParameters)||void 0===s||s.forEach((e=>{if(t.isIdentifier(e.name)){let t=e.name.text;i.push(et(t))}else He.warn("Other typeparameter found!!!")})),i}function Ye(e,s){let i=[];return e.parameters.forEach((e=>{let n=new V;if(t.isIdentifier(e.name))n.setName(e.name.text);else if(t.isObjectBindingPattern(e.name)){n.setName("ObjectBindingPattern");let s=[];e.name.elements.forEach((e=>{let i=new L;e.propertyName&&(t.isIdentifier(e.propertyName)?i.setPropertyName(e.propertyName.text):He.warn("New propertyName of ObjectBindingPattern found, please contact developers to support this!")),e.name&&(t.isIdentifier(e.name)?i.setName(e.name.text):He.warn("New name of ObjectBindingPattern found, please contact developers to support this!")),e.initializer&&He.warn("TODO: support ObjectBindingPattern initializer."),e.dotDotDotToken&&i.setOptional(!0),s.push(i)})),n.setObjElements(s)}else if(t.isArrayBindingPattern(e.name)){n.setName("ArrayBindingPattern");let s=[];e.name.elements.forEach((e=>{let i=new U;t.isBindingElement(e)?(e.propertyName&&(t.isIdentifier(e.propertyName)?i.setPropertyName(e.propertyName.text):He.warn("New propertyName of ArrayBindingPattern found, please contact developers to support this!")),e.name&&(t.isIdentifier(e.name)?i.setName(e.name.text):He.warn("New name of ArrayBindingPattern found, please contact developers to support this!")),e.initializer&&He.warn("TODO: support ArrayBindingPattern initializer."),e.dotDotDotToken&&i.setOptional(!0)):t.isOmittedExpression(e)&&He.warn("TODO: support OmittedExpression for ArrayBindingPattern parameter name."),s.push(i)})),n.setArrayElements(s)}else He.warn("Parameter name is not identifier, please contact developers to support this!");if(e.questionToken&&n.setOptional(!0),e.type)if(t.isTypeReferenceNode(e.type)){let s=e.type.typeName;if(t.isQualifiedName(s)){let e=Qe(s),t=new g(e);n.setType(t)}else if(t.isIdentifier(s)){let e=s.text,t=new g(e);n.setType(t)}}else if(t.isUnionTypeNode(e.type)){let s=[];e.type.types.forEach((e=>{if(t.isTypeReferenceNode(e)){let i="";t.isQualifiedName(e.typeName)?i=Qe(e.typeName):t.isIdentifier(e.typeName)&&(i=e.typeName.text),s.push(new g(i))}else t.isLiteralTypeNode(e)?s.push(et(t.SyntaxKind[e.literal.kind])):s.push(et(t.SyntaxKind[e.kind]))})),n.setType(new N(s))}else if(t.isLiteralTypeNode(e.type))n.setType(et(t.SyntaxKind[e.type.literal.kind]));else if(t.isTypeLiteralNode(e.type)){let i=[];e.type.members.forEach((e=>{t.isPropertySignature(e)?i.push(tt(e,s)):t.isIndexSignatureDeclaration(e)?i.push(st(e,s)):t.isConstructSignatureDeclaration(e)||t.isCallSignatureDeclaration(e)||He.warn("Please contact developers to support new TypeLiteral member!")}));let r=new D;r.setMembers(i),n.setType(r)}else n.setType(et(t.SyntaxKind[e.type.kind]));else n.setType(u.getInstance());i.push(n)})),i}function Ze(e,s){if(e.type){if(t.isTypeLiteralNode(e.type)){let i=[];e.type.members.forEach((e=>{t.isPropertySignature(e)?i.push(tt(e,s)):t.isIndexSignatureDeclaration(e)?i.push(st(e,s)):He.warn("Please contact developers to support new TypeLiteral member!")}));let n=new D;return n.setMembers(i),n}if(t.isTypeReferenceNode(e.type)){let s=e.type.typeName,i="";return t.isQualifiedName(s)?i=Qe(s):t.isIdentifier(s)?i=s.text:He.warn("New type of referenceNodeName found! Please contact developers to support this."),new g(i)}if(t.isUnionTypeNode(e.type)){let s=[];return e.type.types.forEach((e=>{if(t.isTypeReferenceNode(e)){let i="";t.isIdentifier(e.typeName)?i=e.typeName.text:t.isQualifiedName(e.typeName)?i=Qe(e.typeName):t.isTypeLiteralNode(e.typeName)?He.warn("Type name is TypeLiteral, please contact developers to add support for this!"):He.warn("New type name of TypeReference in UnionType."),s.push(new g(i))}else if(t.isLiteralTypeNode(e)){let i=new x(t.SyntaxKind[e.literal.kind]);s.push(i)}else s.push(et(t.SyntaxKind[e.kind]))})),s}if(t.isLiteralTypeNode(e.type)){return new x(t.SyntaxKind[e.type.literal.kind])}return et(t.SyntaxKind[e.type.kind])}return new u}function et(e){let t="";switch(e){case"BooleanKeyword":t="boolean";break;case"NumberKeyword":t="number";break;case"StringKeyword":t="string";break;case"UndefinedKeyword":t="undefined";break;case"NullKeyword":t="null";break;case"AnyKeyword":t="any";break;case"VoidKeyword":t="void";break;case"NeverKeyword":t="never";break;default:t=e}return ze.buildTypeFromStr(t)}function tt(e,s){let i=new $e;if(i.setFieldType(t.SyntaxKind[e.kind]),i.setOriginPosition(Se.buildFromNode(e,s)),t.isComputedPropertyName(e.name))if(t.isIdentifier(e.name.expression)){let t=e.name.expression.text;i.setName(t)}else t.isPropertyAccessExpression(e.name.expression)?i.setName(qe(e.name.expression)):He.warn("Other property expression type found!");else if(t.isIdentifier(e.name)){let t=e.name.text;i.setName(t)}else He.warn("Other property type found!");if(!t.isEnumMember(e)&&e.modifiers){Je(e.modifiers).forEach((e=>{i.addModifier(e)}))}return!t.isEnumMember(e)&&e.type&&i.setType(function(e){if(t.isUnionTypeNode(e)){let s=[];return e.types.forEach((e=>{if(t.isTypeReferenceNode(e)){let i="";t.isQualifiedName(e.typeName)?i=Qe(e.typeName):t.isIdentifier(e.typeName)?i=e.typeName.text:He.warn("Other property type found!"),s.push(new g(i))}else t.isLiteralTypeNode(e)?s.push(et(t.SyntaxKind[e.literal.kind])):s.push(et(t.SyntaxKind[e.kind]))})),s}if(t.isTypeReferenceNode(e)){let s="",i=e.typeName;return t.isQualifiedName(i)?s=Qe(i):t.isIdentifier(i)&&(s=i.text),new g(s)}return t.isLiteralTypeNode(e)?et(t.SyntaxKind[e.literal.kind]):et(t.SyntaxKind[e.kind])}(e.type)),!t.isEnumMember(e)&&e.questionToken&&i.setQuestionToken(!0),t.isPropertyDeclaration(e)&&e.exclamationToken&&i.setExclamationToken(!0),i}function st(e,s){let i=new $e;return i.setFieldType(t.SyntaxKind[e.kind]),i.setParameters(Ye(e,s)),i.setOriginPosition(Se.buildFromNode(e,s)),e.modifiers&&Je(e.modifiers).forEach((e=>{i.addModifier(e)})),i.setType(Ze(e,s)),i}const it=h.getLogger();class nt{constructor(){this.modifiers=new Set,this.className="",this.typeParameters=[],this.heritageClauses=new Map,this.originType="",this.members=[]}build(e,t,s,i,n,r){this.modifiers=e,this.className=t,this.typeParameters=s,this.heritageClauses=i,this.members=n,this.originType=r}getClassName(){return this.className}setClassName(e){this.className=e}getmodifiers(){return this.modifiers}setmodifiers(e){this.modifiers=e}getTypeParameters(){return this.typeParameters}setTypeParameters(e){this.typeParameters=e}getHeritageClauses(){return this.heritageClauses}setHeritageClauses(e){this.heritageClauses=e}getOriginType(){return this.originType}setOriginType(e){this.originType=e}getMembers(){return this.members}setMembers(e){this.members=e}}function rt(s,i){let n="";n=e.isClassDeclaration(s)||e.isClassExpression(s)?"Class":e.isInterfaceDeclaration(s)?"Interface":"Enum";let r=new Set;s.modifiers&&(r=Je(s.modifiers));let o=s.name?s.name.text:"",a=[];e.isEnumDeclaration(s)||(a=Xe(s));let l=new Map;e.isEnumDeclaration(s)||(l=function(e){var s;let i=new Map;return null===(s=e.heritageClauses)||void 0===s||s.forEach((e=>{e.types.forEach((s=>{let n="";t.isIdentifier(s.expression)?n=s.expression.text:t.isPropertyAccessExpression(s.expression)?n=qe(s.expression):He.warn("Other type expression found!!!"),i.set(n,t.SyntaxKind[e.token])}))})),i}(s));let h=[];s.members.forEach((s=>{e.isPropertyDeclaration(s)||e.isPropertySignature(s)||e.isEnumMember(s)?h.push(tt(s,i)):e.isIndexSignatureDeclaration(s)?h.push(st(s,i)):e.isGetAccessor(s)?h.push(function(e,s){let i=new $e;return t.isIdentifier(e.name)?i.setName(e.name.text):(He.warn("Please contact developers to support new type of GetAccessor name!"),i.setName("")),i.setFieldType(t.SyntaxKind[e.kind]),i.setOriginPosition(Se.buildFromNode(e,s)),i}(s,i)):e.isMethodDeclaration(s)||e.isConstructorDeclaration(s)||e.isMethodSignature(s)||e.isConstructSignatureDeclaration(s)||e.isSetAccessor(s)||e.isCallSignatureDeclaration(s)||e.isSemicolonClassElement(s)||it.warn("Please contact developers to support new arkfield type!")}));let c=new nt;return c.build(r,o,a,l,h,n),c}var ot=new Map;function at(e,t){ot.set(e,be(t))}class lt{constructor(){this.clauseType="",this.importFromSignature2Str="",this.importProjectType="ThirdPartPackage"}build(e,t,s,i){this.setImportClauseName(e),this.setImportType(t),this.setImportFrom(s),this.setNameBeforeAs(i)}getImportFromSignature2Str(){return this.importFromSignature2Str}getImportProjectType(){return this.importProjectType}setImportProjectType(e){this.importProjectType=e}setDeclaringFilePath(e){this.declaringFilePath=e}setDeclaringArkFile(e){this.declaringArkFile=e}setProjectPath(e){this.projectPath=e}setImportFromSignature(){let e=new Pe;if(new RegExp("^(\\.\\.\\/|\\.\\/)").test(this.importFrom)){this.setImportProjectType("TargetProject");let t=n.resolve(n.dirname(this.declaringFilePath),this.importFrom),s=n.relative(this.projectPath,t);e.setFileName(s),e.setProjectName(this.declaringArkFile.getProjectName()),this.importFromSignature2Str=e.toString()}ot.forEach(((e,t)=>{if("ohos"==t||"kit"==t||"system"==t){if(new RegExp(`@(${t})\\.`).test(this.importFrom)){this.setImportProjectType("SDKProject");let e="@"+t+"/"+this.importFrom+": ";this.importFromSignature2Str=e}}else{new RegExp(`@(${t})\\/`).test(this.importFrom)&&(this.setImportProjectType("SDKProject"),this.importFromSignature2Str=this.importFrom+": ")}}))}getImportClauseName(){return this.importClauseName}setImportClauseName(e){this.importClauseName=e}getImportType(){return this.importType}setImportType(e){this.importType=e}getImportFrom(){return this.importFrom}setImportFrom(e){this.importFrom=e}getNameBeforeAs(){return this.nameBeforeAs}setNameBeforeAs(e){this.nameBeforeAs=e}getClauseType(){return this.clauseType}setClauseType(e){this.clauseType=e}transfer2UnixPath(e){return n.posix.join(...e.split(/\\/))}}function ht(t){return e.isImportDeclaration(t)?function(t){let s=[],i="";e.isStringLiteral(t.moduleSpecifier)&&(i=t.moduleSpecifier.text);if(!t.importClause){let e="",t="",n=new lt;n.build(e,t,i),s.push(n)}if(t.importClause&&t.importClause.name&&e.isIdentifier(t.importClause.name)){let e=t.importClause.name.text,n="Identifier",r=new lt;r.build(e,n,i),s.push(r)}if(t.importClause&&t.importClause.namedBindings&&e.isNamedImports(t.importClause.namedBindings)){let n="NamedImports";t.importClause.namedBindings.elements&&t.importClause.namedBindings.elements.forEach((t=>{if(t.name&&e.isIdentifier(t.name)){let r=t.name.text;if(t.propertyName&&e.isIdentifier(t.propertyName)){let e=new lt;e.build(r,n,i,t.propertyName.text),s.push(e)}else{let e=new lt;e.build(r,n,i),s.push(e)}}}))}if(t.importClause&&t.importClause.namedBindings&&e.isNamespaceImport(t.importClause.namedBindings)){let n="NamespaceImport";if(t.importClause.namedBindings.name&&e.isIdentifier(t.importClause.namedBindings.name)){let e=t.importClause.namedBindings.name.text,r=new lt;r.build(e,n,i),s.push(r)}}return s}(t):function(t){let s=[],i="EqualsImport";if(t.moduleReference&&e.isExternalModuleReference(t.moduleReference)&&t.moduleReference.expression&&e.isStringLiteral(t.moduleReference.expression)){let e=t.moduleReference.expression.text,n=t.name.text,r=new lt;r.build(n,i,e),s.push(r)}return s}(t)}class ct{constructor(){this.isDefault=!1}build(e,t,s,i){this.setExportClauseName(e),this.setExportClauseType(t),this.setExportFrom(s),this.setNameBeforeAs(i),this.genImportInfo()}getExportClauseName(){return this.exportClauseName}setExportClauseName(e){this.exportClauseName=e}getExportClauseType(){return this.exportClauseType}setExportClauseType(e){this.exportClauseType=e}getExportFrom(){return this.exportFrom}setExportFrom(e){this.exportFrom=e}getNameBeforeAs(){return this.nameBeforeAs}setNameBeforeAs(e){this.nameBeforeAs=e}setDefault(e){this.isDefault=e}getDefault(){return this.isDefault}setImportInfo(e){this.importInfo=e}getImportInfo(){return this.importInfo}genImportInfo(){if(null!=this.exportFrom){let e=new lt;e.build(this.exportClauseName,this.exportClauseType,this.exportFrom,this.nameBeforeAs),this.setImportInfo(e)}}}function dt(t){return e.isExportDeclaration(t)?function(t){let s,i=[];t.moduleSpecifier&&e.isStringLiteral(t.moduleSpecifier)&&(s=t.moduleSpecifier.text);if(t.exportClause&&e.isNamedExports(t.exportClause)&&t.exportClause.elements){let n="NamedExports";t.exportClause.elements.forEach((t=>{let r=t.name.text;if(t.propertyName&&e.isIdentifier(t.propertyName)){let e=new ct;e.build(r,n,s,t.propertyName.text),i.push(e)}else{let e=new ct;e.build(r,n,s),i.push(e)}}))}if(t.exportClause&&e.isNamespaceExport(t.exportClause)){let n="NamespaceExport";if(e.isIdentifier(t.exportClause.name)){let e=t.exportClause.name.text,r="*",o=new ct;o.build(e,n,s,r),i.push(o)}}if(!t.exportClause&&t.moduleSpecifier){let e="NamespaceExport",t="*",n=new ct;n.build(t,e,s),i.push(n)}return i}(t):function(t){let s=[];if(t.expression)if(e.isIdentifier(t.expression)){let e="default",i=t.expression.text,n=new ct;n.build(i,e),s.push(n)}else if(e.isObjectLiteralExpression(t.expression)&&t.expression.properties){let i="default-Obj";t.expression.properties.forEach((t=>{if(t.name&&e.isIdentifier(t.name)){let e=t.name.text,n=new ct;n.build(e,i),s.push(n)}}))}return s}(t)}const ut=h.getLogger();class gt{constructor(){this.modifiers=new Set}getName(){return this.name}setName(e){this.name=e}getModifiers(){return this.modifiers}addModifier(e){this.modifiers.add(e)}}function pt(e){let s=new gt;return e.modifiers&&Je(e.modifiers).forEach((e=>{s.addModifier(e)})),t.isIdentifier(e.name)||t.isStringLiteral(e.name)?s.setName(e.name.text):ut.warn("New namespace name type found. Please contact developers to add support for this!"),s}const ft=h.getLogger();class mt{constructor(t,s,i,n,r,o,a,l,h,c,d){this.line=-1,this.character=-1,this.parent=s,this.children=i,this.text=n,this.start=r,null==t?this.kind=o:(this.kind=e.SyntaxKind[t.kind],"Block"==this.kind||null===this.parent?this.instanceMap=new Map:this.instanceMap=void 0),this.classNodeInfo=a,this.methodNodeInfo=l,this.importNodeInfo=h,this.exportNodeInfo=c,this.namespaceNodeInfo=d}putInstanceMap(e,t){if(void 0===this.instanceMap){let s=this.parent;null!=s&&s.putInstanceMap(e,t)}else this.instanceMap.set(e,t)}checkInstanceMap(e){let t=this.parent;if(void 0!==this.instanceMap&&this.instanceMap.has(e)){let t=this.instanceMap.get(e);return void 0!==t?t:null}return null!=t?t.checkInstanceMap(e):null}}class St{constructor(t){this.root=new mt(void 0,null,[],"undefined",0,"undefined"),this.text=t,this.sourceFile=e.createSourceFile("example.ts",this.text,e.ScriptTarget.Latest),this.buildTree()}copyTree(t,s){let i=null==s?void 0:s.getChildren(this.sourceFile);if(null==i)return;let n=[];for(let s of i){let i,r,o,a,l,h;(e.isClassDeclaration(s)||e.isClassExpression(s)||e.isInterfaceDeclaration(s)||e.isEnumDeclaration(s))&&(r=rt(s,this.sourceFile)),(e.isFunctionDeclaration(s)||e.isMethodDeclaration(s)||e.isConstructorDeclaration(s)||e.isArrowFunction(s)||e.isFunctionExpression(s)||e.isAccessor(s)||e.isMethodSignature(s)||e.isConstructSignatureDeclaration(s)||e.isCallSignatureDeclaration(s))&&(o=R(s,this.sourceFile)),(e.isImportDeclaration(s)||e.isImportEqualsDeclaration(s))&&(a=ht(s)),(e.isExportDeclaration(s)||e.isExportAssignment(s))&&(l=dt(s)),e.isModuleDeclaration(s)&&(h=pt(s)),i=new mt(s,t,[],s.getText(this.sourceFile),s.getStart(this.sourceFile),"",r,o,a,l,h);const{line:c,character:d}=e.getLineAndCharacterOfPosition(this.sourceFile,s.getStart(this.sourceFile));i.line=c,i.character=d,this.copyTree(i,s),n.push(i),i.parent=t}t.children=n}buildTree(){const t=this.sourceFile.getChildren(this.sourceFile)[0];null==t&&process.exit(0);const s=new mt(t,null,[],t.getText(this.sourceFile),t.getStart(this.sourceFile),""),{line:i,character:n}=e.getLineAndCharacterOfPosition(this.sourceFile,t.getStart(this.sourceFile));s.line=i,s.character=n,this.root=s,this.copyTree(s,t)}singlePrintAST(e,t){if(ft.info("   ".repeat(t)+e.kind),null!=e.children)for(let s of e.children)this.singlePrintAST(s,t+1)}printAST(){null==this.root&&ft.warn("no root"),this.singlePrintAST(this.root,0)}For2While(e){let t=-1,s=-1;for(let i=0;i<e.children.length;i++)"SemicolonToken"==e.children[i].kind&&(-1==t?t=i:s=i);let i=new mt(void 0,e.parent,[],"",-1,"WhileStatement"),n=new mt(void 0,i,[],"while",-1,"WhileKeyword"),r=new mt(void 0,i,[],"(",-1,"OpenParenToken"),o=new mt(void 0,i,[],")",-1,"CloseParenToken"),a=e.children[t+1],l=e.children[e.children.length-1];if(l.parent=i,i.children=[n,r,a,o,l],e.parent||(ft.error("for without parent"),process.exit()),e.parent.children[e.parent.children.indexOf(e)]=i,"OpenParenToken"!=e.children[t-1].kind){let s="",n=e.children[t-1];s="VariableDeclarationList"==n.kind?"FirstStatement":"ExpressionStatement";let r=new mt(void 0,i,[],";",-1,"SemicolonToken"),o=new mt(void 0,e.parent,[n,r],n.text+";",-1,s);e.parent.children.splice(e.parent.children.indexOf(i),0,o)}if("CloseParenToken"!=e.children[s-1].kind){let t=e.children[s+1],n=new mt(void 0,i,[],";",-1,"SemicolonToken"),r=new mt(void 0,l,[t,n],t.text+";",-1,"ExpressionStatement");l.children[1].children.push(r)}this.updateParentText(l.children[1])}findChildIndex(e,t){for(let s=0;s<e.children.length;s++)if(e.children[s].kind==t)return s;return-1}forOfIn2For(e){let t=e.children[this.findChildIndex(e,"VariableDeclarationList")],s=t.children[this.findChildIndex(t,"SyntaxList")].children[0].children[0].text,i=e.children[this.findChildIndex(e,"CloseParenToken")-1].text,n=new St("for(let _i=0;_i<"+i+".length;_i++)"),r=n.root.children[0];r.parent=e.parent,e.parent&&(e.parent.children[e.parent.children.indexOf(e)]=r);let o=e.children[this.findChildIndex(e,"Block")];r.children[r.children.length-1]=o,n=new St("let "+s+"="+i+"[_i];");let a=n.root.children[0];return o.children[1].children.splice(0,0,a),this.updateParentText(r),r}simplify(e){"ForInStatement"!=e.kind&&"ForOfStatement"!=e.kind||this.For2While(this.forOfIn2For(e)),"ForStatement"==e.kind&&this.For2While(e);for(let t of e.children)this.simplify(t)}updateParentText(e){if(e){e.text="";for(let t of e.children)e.text+=t.text,t.kind.includes("Keyword")&&(e.text+=" "),"SyntaxList"==e.kind&&t.kind.includes("Statement")&&(e.text+="\r\n");e.parent&&this.updateParentText(e.parent)}}updateStart(e){for(let t=0;t<e.children.length;t++)e.children[t].start=0==t?e.start:e.children[t-1].start+e.children[t].text.length,this.updateStart(e.children[t])}}class kt{constructor(e,t=u.getInstance()){this.value=e,this.type=t}getValue(){return this.value}setValue(e){this.value=e}getUses(){return[]}getType(){return this.type}setType(e){this.type=e}toString(){return this.value}}let yt=class{constructor(e,t,s){this.value=e,this.def=t,this.use=s}};var xt;!function(e){e[e.TAINT=0]="TAINT"}(xt||(xt={}));class Nt{constructor(){this.stmts=[],this.predecessorBlocks=[],this.successorBlocks=[]}getStmts(){return this.stmts}addStmt(e){this.stmts.push(e)}getHead(){return 0==this.stmts.length?null:this.stmts[0]}getTail(){let e=this.stmts.length;return 0==e?null:this.stmts[e-1]}getSuccessors(){return this.successorBlocks}setSuccessorBlock(e,t){return this.updateSuccessorContainer(),!(e>=this.successorBlocks.length)&&(this.successorBlocks[e]=t,!0)}getPredecessors(){return this.predecessorBlocks}addPredecessorBlock(e){this.predecessorBlocks.push(e)}updateSuccessorContainer(){let e=this.getTail();if(e){let t=e.getExpectedSuccessorCount();t!=this.successorBlocks.length&&(this.successorBlocks=new Array(t))}}addStmtToFirst(e){this.stmts.splice(0,0,e)}addSuccessorBlock(e){this.successorBlocks.push(e)}toString(){let e=[];for(const t of this.stmts)e.push(t.toString()+"\n");return e.join("")}}class Tt{constructor(){this.blocks=new Set,this.stmtToBlock=new Map,this.startingStmt=new ke,this.defUseChains=[]}getStmts(){let e=new Array;for(const t of this.blocks)e.push(...t.getStmts());return e}insertBefore(e,t){const s=this.stmtToBlock.get(e);s.addStmtToFirst(t),this.stmtToBlock.set(t,s)}addBlock(e){this.blocks.add(e);for(const t of e.getStmts())this.stmtToBlock.set(t,e)}getBlocks(){return this.blocks}getStartingBlock(){return this.stmtToBlock.get(this.startingStmt)}getStartingStmt(){return this.startingStmt}setStartingStmt(e){this.startingStmt=e}getDeclaringMethod(){return this.declaringMethod}setDeclaringMethod(e){this.declaringMethod=e}getDefUseChains(){return this.defUseChains}toString(){return"cfg"}buildDefUseStmt(){for(const e of this.blocks)for(const t of e.getStmts()){const e=t.getDef();e&&e instanceof te&&e.setDeclaringStmt(t);for(const e of t.getUses())if(e instanceof te){e.addUsedStmt(t)}}}buildDefUseChain(){var e,t;for(const s of this.blocks)for(let i=0;i<s.getStmts().length;i++){const n=s.getStmts()[i];for(const r of n.getUses()){const o=r.toString(),a=[];for(let t=i-1;t>=0;t--){const i=s.getStmts()[t];if(i.getDef()&&(null===(e=i.getDef())||void 0===e?void 0:e.toString())==o){a.push(i);break}}if(0!=a.length)this.defUseChains.push(new yt(r,a[0],n));else{const e=[];for(const t of s.getPredecessors())e.push(t);const i=new Set;for(;e.length>0;){const s=e.pop();if(!s)return;const n=s.getStmts();let r=!1;for(let e=n.length-1;e>=0;e--){const s=n[e];if(s.getDef()&&(null===(t=s.getDef())||void 0===t?void 0:t.toString())==o){a.push(s),r=!0;break}}if(!r)for(const t of s.getPredecessors())i.has(t)||e.includes(t)||e.unshift(t);i.add(s)}for(const e of a)this.defUseChains.push(new yt(r,e,n))}}}}}class wt{constructor(e){this.blocks=[],this.blockToIdx=new Map,this.idoms=[],this.domFrontiers=[],this.blocks=Array.from(e.getBlocks());for(let e=0;e<this.blocks.length;e++){let t=this.blocks[e];this.blockToIdx.set(t,e)}const t=e.getStartingBlock();this.idoms=new Array(this.blocks.length),this.idoms[0]=0;for(let e=1;e<this.idoms.length;e++)this.idoms[e]=-1;let s=!0;for(;s;){s=!1;for(const e of this.blocks){if(e==t)continue;let i=this.blockToIdx.get(e),n=Array.from(e.getPredecessors()),r=this.getFirstDefinedBlockPredIdx(n);if(n.length>0&&-1!=r){for(const e of n){let t=this.blockToIdx.get(e);-1!=this.idoms[t]&&(r=this.intersect(r,t))}this.idoms[i]!=r&&(this.idoms[i]=r,s=!0)}}}this.domFrontiers=new Array(this.blocks.length);for(let e=0;e<this.domFrontiers.length;e++)this.domFrontiers[e]=new Array;for(const e of this.blocks){let t=Array.from(e.getPredecessors());if(t.length>1){let s=this.blockToIdx.get(e);for(const e of t){let t=this.blockToIdx.get(e);for(;t!=this.idoms[s];)this.domFrontiers[t].push(s),t=this.idoms[t]}}}}getDominanceFrontiers(e){if(!this.blockToIdx.has(e))throw new Error("The given block: "+e+" is not in Cfg!");let t=this.blockToIdx.get(e),s=new Set,i=this.domFrontiers[t];for(const e of i)s.add(this.blocks[e]);return s}getBlocks(){return this.blocks}getBlockToIdx(){return this.blockToIdx}getImmediateDominators(){return this.idoms}getFirstDefinedBlockPredIdx(e){for(const t of e){let e=this.blockToIdx.get(t);if(-1!=this.idoms[e])return e}return-1}intersect(e,t){for(;e!=t;)e>t?e=this.idoms[e]:t=this.idoms[t];return e}}class Ct{constructor(e){this.blocks=[],this.blockToIdx=new Map,this.children=[],this.parents=[],this.blocks=e.getBlocks(),this.blockToIdx=e.getBlockToIdx();let t=e.getImmediateDominators(),s=this.blocks.length;this.children=new Array(s),this.parents=new Array(s);for(let e=0;e<s;e++)this.children[e]=new Array,this.parents[e]=-1;for(let e=0;e<s;e++)t[e]!=e&&(this.parents[e]=t[e],this.children[t[e]].push(e))}getAllNodesDFS(){let e=new Array,t=new Array;for(t.push(this.getRoot());0!=t.length;){let s=t.splice(0,1)[0];e.push(s);let i=this.getChildren(s);if(0!=i.length)for(let e=i.length-1;e>=0;e--)t.splice(0,0,i[e])}return e}getChildren(e){let t=new Array,s=this.blockToIdx.get(e);for(const e of this.children[s])t.push(this.blocks[e]);return t}getRoot(){return this.blocks[0]}}const It=new Set(["Badge","Button","Calendar","Canvas","Checkbox","CheckboxGroup","ColorPicker","ColorPickerDialog","Column","ColumnSplit","ContainerSpan","Counter","DataPanel","DatePicker","EffectComponent","Flex","FlowItem","FolderStack","FormLink","Gauge","Grid","GridItem","GridCol","GridContainer","GridRow","Hyperlink","List","ListItem","ListItemGroup","Menu","MenuItem","MenuItemGroup","Navigation","Navigator","NavDestination","NavRouter","Option","Panel","Piece","PluginComponent","QRCode","Rating","Refresh","RelativeContainer","RootScene","Row","RowSplit","Screen","Scroll","ScrollBar","Section","Select","Shape","Sheet","SideBarContainer","Stack","Stepper","StepperItem","Swiper","Tabs","TabContent","Text","TextPicker","TextTimer","TextClock","TimePicker","Toggle","WaterFlow","WindowScene","XComponent","ForEach","LazyForEach","If"]),Ft=new Set(["create","createWithChild","createWithLabel"]);class At{constructor(e,t,s,i,n){this.name=e,this.stmts=new Map,this.parent=i,this.children=[],this.tree=n,this.addStmt(t,s)}addStmt(e,t){let s=t.getMethodSignature().getMethodSubSignature().getMethodName(),i=[];for(const e of t.getArgs())e instanceof te&&this.getBindValues(e,i);this.stmts.set(s,[e,i])}getBindValues(e,t){const s=e.getDeclaringStmt();if(s)for(const e of s.getUses())e instanceof kt?t.push(e):e instanceof oe?this.tree.isClassField(e.getFieldName())&&t.push(e):e instanceof te&&this.getBindValues(e,t);else{let s=e.getType();s instanceof C&&t.push(s.getMethodSignature())}}}class Et{constructor(e){this.render=e,this.fieldTypes=new Map}buildViewTree(){return de(this,void 0,void 0,(function*(){if(!this.render||this.isInitialized())return;yield this.loadClasssFieldTypes();yield this.parseCfg(this.render.getCfg(),[])}))}isInitialized(){return null!=this.root}getRoot(){return this.root}parseForEachAnonymousFunc(e,t){let s=t.getArg(3).getType(),i=this.render.getDeclaringArkClass().getMethod(s.getMethodSignature());i&&this.parseCfg(i.getCfg(),e)}parseComponentView(e,t){return de(this,void 0,void 0,(function*(){let s,i=t.getArg(0).getDeclaringStmt().getRightOp();if(!(i instanceof z))return!1;s=i.getType().getClassSignature();let n=this.render.getDeclaringArkFile().getScene().getClass(s),r=yield null==n?void 0:n.getViewTree();return r&&e.children.push(r.getRoot()),!0}))}parseCfg(e,t){return de(this,void 0,void 0,(function*(){let s=e.getBlocks();for(const e of s)for(const s of e.getStmts()){if(!(s instanceof xe))continue;let e=s.getInvokeExpr();if(!(e instanceof _))continue;let i=e.getBase().getName();if(i.startsWith("$temp"))continue;let n=e.getMethodSignature().getMethodSubSignature().getMethodName();this.popAutomicComponent(i,t);let r=t.length>0?t[t.length-1]:null;if("If"!=i||"branchId"!=n)if(this.isCreateFunc(n)){let n=this.getParent(t),r=new At(i,s,e,n,this);if("View"==i&&!(yield this.parseComponentView(r,e)))continue;null==n?this.root=r:n.children.push(r),t.push(r),"ForEach"!=i&&"LazyForEach"!=i||this.parseForEachAnonymousFunc(t,e)}else i==(null==r?void 0:r.name)&&(r.addStmt(s,e),"pop"==n&&t.pop())}}))}popAutomicComponent(e,t){if(0==t.length)return;let s=t[t.length-1];e==s.name||this.isContainer(s.name)||t.pop()}getParent(e){if(0==e.length)return null;let t=e[e.length-1];return this.isContainer(t.name)||e.pop(),e[e.length-1]}isContainer(e){return It.has(e)}isCreateFunc(e){return Ft.has(e)}loadClasssFieldTypes(){return de(this,void 0,void 0,(function*(){let e=this.render.getDeclaringArkFile();for(const t of this.render.getDeclaringArkClass().getFields()){let s=t.getSignature().getType();if(s instanceof g){let i=yield e.getEtsOriginalPositionFor(t.getOriginPosition()),n=yield e.getEtsSource(i.getLineNo());if(n.length<i.getColNo())this.fieldTypes.set(t.getName(),s.getName());else{let e=n.slice(i.getColNo());this.fieldTypes.set(t.getName(),e.split(" ")[0])}}}for(const e of this.render.getDeclaringArkClass().getMethods()){let t=e.getName();t.startsWith("Set-")&&(t=t.replace("Set-",""),this.fieldTypes.has("__"+t)&&this.fieldTypes.set(t,this.fieldTypes.get("__"+t)))}}))}isClassField(e){return this.fieldTypes.has(e)}getClassFieldType(e){return this.fieldTypes.get(e)}}class bt{constructor(e,t,s,i){this.methodSignature=e,this.locals=t,this.originalCfg=s,this.cfg=i}getLocals(){return this.locals}setLocals(e){this.locals=e}getCfg(){return this.cfg}setCfg(e){this.cfg=e}getOriginalCfg(){return this.originalCfg}setOriginalCfg(e){this.originalCfg=e}getMethodSignature(){return this.methodSignature}setMethodSignature(e){this.methodSignature=e}}class Pt{static moreThanOneAddress(e){return e instanceof H||e instanceof K||e instanceof oe||e instanceof ne}}const Dt=h.getLogger();class vt{constructor(e,t,s,i){this.passTmies=0,this.numOfIdentifier=0,this.isDoWhile=!1,this.type=e,this.code=t,this.next=null,this.lasts=[],this.walked=!1,this.index=0,this.line=0,this.astNode=s,this.scopeID=i,this.use=new Set,this.def=new Set,this.defspecial=new Set,this.addressCode3=[],this.threeAddressStmts=[],this.haveCall=!1,this.block=null,this.ifExitPass=!1}}class Mt extends vt{constructor(e,t,s,i){super(e,t,s,i),this.doStatement=null,this.nextT=null,this.nextF=null,this.loopBlock=null,this.condition=""}}class Ot extends vt{constructor(e,t,s,i){super(e,t,s,i),this.cases=[],this.default=null,this.nexts=[]}}class Bt extends vt{constructor(e,t,s,i){super(e,t,s,i),this.tryFirst=null,this.tryExit=null,this.catchStatement=null,this.catchError="",this.finallyStatement=null}}class Lt{constructor(e,t){this.value=e,this.stm=t}}class Ut{constructor(e,t){this.def=e,this.use=t}}class Vt{constructor(e,t){this.properties=[],this.propOf=null,this.name=e,this.lastDef=t,this.defUse=[]}}let jt=class{constructor(e,t,s){this.id=e,this.variable=t,this.level=s,this.parent=null}};class Rt{constructor(e,t,s){this.walked=!1,this.id=e,this.stms=t,this.nexts=new Set,this.lasts=new Set,this.loopStmt=s}}class Wt{constructor(e,t,s,i){this.errorName=e,this.from=t,this.to=s,this.withLabel=i}}class Kt extends Error{constructor(e){super(e),this.name="textError"}}class _t{constructor(e,t,s){this.locals=new Set,this.thisLocal=new te("this"),this.paraLocals=[],this.name=t,this.astRoot=e,this.declaringMethod=s,this.declaringClass=s.getDeclaringArkClass(),this.entry=new vt("entry","",e,0),this.loopStack=[],this.switchExitStack=[],this.functions=[],this.breakin="",this.statementArray=[],this.dotEdges=[],this.exit=new vt("exit","return;",null,0),this.scopes=[],this.scopeLevel=0,this.tempVariableNum=0,this.current3ACstm=this.entry,this.blocks=[],this.entryBlock=new Rt(this.blocks.length,[this.entry],null),this.exitBlock=new Rt(-1,[this.entry],null),this.currentDeclarationKeyword="",this.variables=[],this.importFromPath=[],this.catches=[],this.anonymousFuncIndex=0,this.anonymousFunctions=[],this.anonymousClassIndex=0,this.buildCfgBuilder()}walkAST(e,t,s){var i;function n(t){if("ifStatement"==e.type){let s=e;null==s.nextT?s.nextT=t:s.nextF=t}else if("loopStatement"==e.type){e.nextT=t}else if("catchOrNot"==e.type){e.nextT=t}else e.next=t}this.scopeLevel++;let r=new jt(this.scopes.length,new Set,this.scopeLevel);for(let e=this.scopes.length-1;e>=0;e--)if(this.scopes[e].level==this.scopeLevel-1){r.parent=this.scopes[e];break}this.scopes.push(r);for(let t=0;t<(null==s?void 0:s.children.length);t++){let o=s.children[t];if("FirstStatement"==o.kind||"VariableStatement"==o.kind||"ExpressionStatement"==o.kind||"ThrowStatement"==o.kind){if("FirstStatement"==o.kind||"VariableStatement"==o.kind){let e=o.children[this.findChildIndex(o,"VariableDeclarationList")];e=e.children[this.findChildIndex(e,"SyntaxList")];for(let t of e.children)r.variable.add(null===(i=t.children[0])||void 0===i?void 0:i.text)}let t=new vt("statement",o.text,o,r.id);n(t),e=t}if("ImportDeclaration"==o.kind){let t=new vt("statement",o.text,o,r.id);n(t),e=t,t.astNode=o;let s=this.findChildIndex(o,"FromKeyword")+1;this.importFromPath.push(o.children[s].text)}if("ReturnStatement"==o.kind){let t=new vt("returnStatement",o.text,o,r.id);n(t),t.astNode=o,e=t;break}if("BreakStatement"==o.kind){let t=new vt("breakStatement","break;",o,r.id);n(t);let s=o;for(;s;){if(s.kind.includes("While")||s.kind.includes("For")){t.next=this.loopStack[this.loopStack.length-1].nextF;break}if(s.kind.includes("CaseClause")||s.kind.includes("DefaultClause")){t.next=this.switchExitStack[this.switchExitStack.length-1];break}s=s.parent}e=t}if("ContinueStatement"==o.kind){let t=new vt("continueStatement","continue;",o,r.id);n(t),t.next=this.loopStack[this.loopStack.length-1],e=t}if("IfStatement"==o.kind){let t=new Mt("ifStatement","",o,r.id);n(t);let s=new vt("ifExit","",o,r.id),i=!1;for(let e=0;e<o.children.length;e++){let n=o.children[e];if("OpenParenToken"==n.kind&&(t.condition=o.children[e+1].text,t.code="if ("+t.condition+")"),("CloseParenToken"==n.kind||"ElseKeyword"==n.kind)&&"Block"!=o.children[e+1].kind){let t=new mt(void 0,o,[],"undefined",0,"Block");t.kind="Block",t.text="tempBlock";let s=new mt(void 0,t,[],"undefined",0,"undefined"),i=new mt(void 0,t,[o.children[e+1]],"undefined",0,"undefined");t.children=[s,i],o.children[e+1]=t}"ElseKeyword"==n.kind&&(i=!0),"Block"==n.kind&&this.walkAST(t,s,n.children[1])}i&&t.nextF||(t.nextF=s),t.nextT||(t.nextT=s),e=s}if("WhileStatement"==o.kind){this.breakin="loop";let t=new Mt("loopStatement","",o,r.id);this.loopStack.push(t),n(t);let s=new vt("loopExit","",o,r.id);t.nextF=s;for(let e=0;e<o.children.length;e++){let s=o.children[e];if("OpenParenToken"==s.kind&&(t.condition=o.children[e+1].text,t.code="while ("+t.condition+")"),"CloseParenToken"==s.kind&&"Block"!=o.children[e+1].kind){let t=new mt(void 0,o,[],"undefined",0,"Block");t.kind="Block",t.text="tempBlock";let s=new mt(void 0,t,[],"undefined",0,"undefined"),i=new mt(void 0,t,[o.children[e+1]],"undefined",0,"undefined");t.children=[s,i],o.children[e+1]=t}"Block"==s.kind&&this.walkAST(t,t,s.children[1])}t.nextF||(t.nextF=s),t.nextT||(t.nextT=s),e=s,this.loopStack.pop()}if("ForStatement"==o.kind||"ForInStatement"==o.kind||"ForOfStatement"==o.kind){this.breakin="loop";let t=new Mt("loopStatement","",o,r.id);this.loopStack.push(t),n(t);let s=new vt("loopExit","",o,r.id);t.nextF=s;let i="";for(let e of o.children)if("Block"!=e.kind){i+=e.text;const t=o.children[o.children.indexOf(e)+1];t&&"("!=e.text&&")"!=t.text&&";"!=t.text&&(i+=" ")}else t.code=i,this.walkAST(t,t,e.children[1]);t.nextF||(t.nextF=s),t.nextT||(t.nextT=s),e=s,this.loopStack.pop()}if("DoStatement"==o.kind){this.breakin="loop";let t=new Mt("loopStatement","",o,r.id);this.loopStack.push(t);let s=new vt("loopExit","",o,r.id);t.nextF=s;for(let s=0;s<o.children.length;s++){let i=o.children[s];"OpenParenToken"==i.kind&&(t.condition=o.children[s+1].text,t.code="while ("+t.condition+")"),"Block"==i.kind&&this.walkAST(e,t,i.children[1])}let i=e.type;if("ifStatement"==i||"loopStatement"==i){let s=e;t.nextT=s.nextT}else t.nextT=e.next;t.nextT&&t.nextT!=t&&(t.nextT.isDoWhile=!0,t.doStatement=t.nextT),e=s,this.loopStack.pop()}if("SwitchStatement"==o.kind){this.breakin="switch";let t=new Ot("switchStatement","",o,r.id);n(t);let s=new vt("switchExit","",null,r.id);this.switchExitStack.push(s);for(let e of o.children)if("CaseBlock"!=e.kind)t.code+=e.text;else{let i=null,n=[];for(let o=0;o<e.children[1].children.length;o++){let a=e.children[1].children[o],l=null,h="";for(let e of a.children){if("SyntaxList"==e.kind){l=e;break}h+=e.text+" "}if(null==l&&(Dt.warn("caseClause without syntaxList"),process.exit()),0==l.children.length)n.push(h);else{let c=h;for(let e of n)h+=e+" ";let d=new vt("statement",h,a,r.id);t.nexts.push(d);let u=new vt("caseExit","",null,r.id);this.walkAST(d,u,l);for(let e of n)if(d.next){let s=new Lt(e,d.next);t.cases.push(s)}if(d.next)if("CaseClause"==a.kind){let e=new Lt(c,d.next);t.cases.push(e)}else t.default=d.next;i&&(i.next=d.next),o==e.children[1].children.length-1?u.next=s:i=u,n=[]}}i&&!i.next&&(i.next=s)}e=s,this.switchExitStack.pop()}if("Block"==o.kind){let t=new vt("blockExit","",o,r.id);this.walkAST(e,t,o.children[1]),e=t}if("TryStatement"==o.kind){let t=new Bt("tryStatement","try",o,r.id);n(t);let s=new vt("try exit","",o,r.id);t.tryExit=s,this.walkAST(t,s,o.children[1].children[1]),t.tryFirst=t.next;let i=null,a=null,l=!1;for(let e of o.children){if(l){a=e;break}if("CatchClause"==e.kind){i=e;let s="catch";i.children.length>2&&(s=i.children[0].text+i.children[1].text+i.children[2].text+i.children[3].text);let n=new Mt("catchOrNot",s,o,r.id),a=new vt("catch exit","",o,r.id);n.nextF=a;let l=i.children[this.findChildIndex(i,"Block")];this.walkAST(n,a,l.children[1]),n.nextT||(n.nextT=a);const h=new vt("statement",n.code,e,n.nextT.scopeID);h.next=n.nextT,t.catchStatement=h;let c=i.children[this.findChildIndex(i,"VariableDeclaration")];if(c)if("Identifier"==c.children[0].kind)t.catchError=c.children[0].text;else{let e=c.children[this.findChildIndex(c,"TypeReference")];t.catchError=e?e.text:"Error"}else t.catchError="Error"}"FinallyKeyword"==e.kind&&(l=!0)}if(a&&a.children[1].children.length>0){let e=new vt("statement","finally",o,r.id),s=new vt("finally exit","",o,r.id);this.walkAST(e,s,a.children[1]),t.finallyStatement=e.next}e=t}}this.scopeLevel--,"breakStatement"!=e.type&&"continueStatement"!=e.type&&(e.next=t)}addReturnInEmptyMethod(){if(this.entry.next==this.exit){const e=new vt("returnStatement","return;",null,this.entry.scopeID);this.entry.next=e,e.next=this.exit}}deleteExit(e){var t,s,i;if(!e.walked)if(e.walked=!0,"ifStatement"==e.type||"loopStatement"==e.type||"catchOrNot"==e.type){let i=e;if(null===(t=i.nextT)||void 0===t?void 0:t.type.includes("Exit")){let e=i.nextT;for(;e.type.includes("Exit");)null==e.next&&(Dt.error("exit error"),process.exit()),e=e.next;i.nextT=e}if(null===(s=i.nextF)||void 0===s?void 0:s.type.includes("Exit")){let e=i.nextF;for(;e.type.includes("Exit");)null==e.next&&(Dt.error("exit error"),process.exit()),e=e.next;i.nextF=e}if(null==i.nextT||null==i.nextF)return void this.errorTest(i);this.deleteExit(i.nextT),this.deleteExit(i.nextF)}else if("switchStatement"==e.type){let t=e;for(let e in t.nexts){let s=t.nexts[e];if(s.type.includes("Exit")){let i=s;for(;i.type.includes("Exit");)null==i.next&&(Dt.error("exit error"),process.exit()),i=i.next;t.nexts[e]=i}this.deleteExit(t.nexts[e])}}else if("tryStatement"==e.type){let t=e;t.tryFirst&&this.deleteExit(t.tryFirst),t.catchStatement&&this.deleteExit(t.catchStatement),t.finallyStatement&&this.deleteExit(t.finallyStatement)}else{if(null===(i=e.next)||void 0===i?void 0:i.type.includes("Exit")){let t=e.next;for(;t.type.includes("Exit");)null==t.next&&(Dt.error("error exit"),process.exit()),t=t.next;e.next=t}e.next&&this.deleteExit(e.next)}}buildNewBlock(e){let t;return this.blocks.length>0&&0==this.blocks[this.blocks.length-1].stms.length?(t=this.blocks[this.blocks.length-1],t.stms=e):(t=new Rt(this.blocks.length,e,null),this.blocks.push(t)),t}buildBlocks(e,t){if(e.type.includes(" exit"))e.block=t;else if(!e.walked&&"exit"!=e.type)if(e.walked=!0,"entry"!=e.type){if(("loopStatement"!=e.type&&"tryStatement"!=e.type||e instanceof Mt&&e.doStatement)&&(t.stms.push(e),e.block=t),"ifStatement"==e.type||"loopStatement"==e.type||"catchOrNot"==e.type){let s=e;if(null==s.nextT||null==s.nextF)return void this.errorTest(s);if("loopStatement"==s.type&&!s.doStatement){t=this.buildNewBlock([s]),s.block=t}let i=this.buildNewBlock([]);this.buildBlocks(s.nextT,i);let n=this.buildNewBlock([]);this.buildBlocks(s.nextF,n)}else if("switchStatement"==e.type){let t=e;for(const e of t.cases)this.buildBlocks(e.stm,this.buildNewBlock([]));t.default&&this.buildBlocks(t.default,this.buildNewBlock([]))}else if("tryStatement"==e.type){let s=e;s.tryFirst||(Dt.error("try without tryFirst"),process.exit());let i=this.buildNewBlock([]);s.block=i,t.stms.length>0&&(t.nexts.add(i),i.lasts.add(t)),this.buildBlocks(s.tryFirst,i);const n=new Set;s.tryExit||process.exit();for(let e of s.tryExit.lasts)e.block&&n.add(e.block);let r=this.buildNewBlock([]),o=null;if(s.finallyStatement)this.buildBlocks(s.finallyStatement,r),o=this.blocks[this.blocks.length-1];else{let e=new vt("tmp","",null,-1);r.stms=[e]}for(let e of n)e.nexts.add(r),r.lasts.add(e);if(s.catchStatement){let e=this.buildNewBlock([]);this.buildBlocks(s.catchStatement,e);for(let t of n)t.nexts.add(e),e.lasts.add(t);e.nexts.add(r),r.lasts.add(e),this.catches.push(new Wt(s.catchError,i.id,r.id,e.id))}let a=this.buildNewBlock([]);o&&(r=o),s.next&&this.buildBlocks(s.next,a);let l=new vt("gotoStatement","goto label"+a.id,null,s.tryFirst.scopeID);if(l.block=r,s.finallyStatement?s.catchStatement&&r.stms.push(l):r.stms=[l],r.nexts.add(a),a.lasts.add(r),0==a.stms.length){const e=new vt("returnStatement","return;",null,s.tryFirst.scopeID);l.next=e,e.lasts=[l],a.stms.push(e),e.block=a}}else if(e.next){if("continueStatement"==e.type&&e.next.block)return;if("loopStatement"==e.next.type&&e.next.block)return void(t=e.next.block);if(e.next.passTmies++,e.next.passTmies==e.next.lasts.length||"loopStatement"==e.next.type||e.next.isDoWhile){if(!(e.next.scopeID==e.scopeID||e.next.type.includes(" exit")||e.next instanceof Mt&&e.next.doStatement)){t=this.buildNewBlock([])}this.buildBlocks(e.next,t)}}}else{let t=this.buildNewBlock([]);null!=e.next&&this.buildBlocks(e.next,t)}}buildBlocksNextLast(){var e,t,s,i,n,r;for(let o of this.blocks)for(let a of o.stms){let l=o.stms.indexOf(a)==o.stms.length-1;if(a instanceof Mt){let n=null===(e=a.nextT)||void 0===e?void 0:e.block;!n||!l&&n==o||(null===(t=a.nextT)||void 0===t?void 0:t.type.includes(" exit"))||(o.nexts.add(n),n.lasts.add(o));let r=null===(s=a.nextF)||void 0===s?void 0:s.block;!r||!l&&r==o||(null===(i=a.nextF)||void 0===i?void 0:i.type.includes(" exit"))||(o.nexts.add(r),r.lasts.add(o))}else if(a instanceof Ot){for(const e of a.cases){const t=e.stm.block;!t||!l&&t==o||e.stm.type.includes(" exit")||(o.nexts.add(t),t.lasts.add(o))}if(a.default){const e=a.default.block;!e||!l&&e==o||a.default.type.includes(" exit")||(o.nexts.add(e),e.lasts.add(o))}}else{let e=null===(n=a.next)||void 0===n?void 0:n.block;!e||!l&&e==o||(null===(r=a.next)||void 0===r?void 0:r.type.includes(" exit"))||(o.nexts.add(e),e.lasts.add(o))}}}addReturnBlock(){var e,t;let s=[];for(let e of this.exit.lasts)"returnStatement"!=e.type&&s.push(e);if(s.length<1)return;const i=new vt("returnStatement","return;",null,this.exit.scopeID);if(1!=s.length||s[0]instanceof Mt){let e=new Rt(this.blocks.length,[i],null);i.block=e,this.blocks.push(e);for(const n of s)n.next=i,i.lasts.push(n),i.next=this.exit,this.exit.lasts[this.exit.lasts.indexOf(n)]=i,null===(t=n.block)||void 0===t||t.nexts.add(e)}else{const t=s[0];t.next=i,i.lasts=[t],i.next=this.exit,this.exit.lasts[this.exit.lasts.indexOf(t)]=i,null===(e=t.block)||void 0===e||e.stms.push(i),i.block=t.block}}nodeHaveCall(e){if("CallExpression"==e.kind||"NewExpression"==e.kind)return!0;let t=!1;for(let s of e.children)"Block"!=s.kind&&(t=t||this.nodeHaveCall(s));return t}buildLastAndHaveCall(e){var t;if(!e.walked)if(e.walked=!0,e.astNode&&(e.haveCall=this.nodeHaveCall(e.astNode),e.line=e.astNode.line+1,e.column=e.astNode.character+1),"ifStatement"==e.type||"loopStatement"==e.type||"catchOrNot"==e.type){let t=e;if(null==t.nextT||null==t.nextF)return void this.errorTest(t);t.nextT.lasts.push(t),t.nextF.lasts.push(t),this.buildLastAndHaveCall(t.nextT),this.buildLastAndHaveCall(t.nextF)}else if("switchStatement"==e.type){let t=e;for(let e of t.nexts)e.lasts.push(t),this.buildLastAndHaveCall(e)}else if("tryStatement"==e.type){let t=e;t.tryFirst&&this.buildLastAndHaveCall(t.tryFirst),t.catchStatement&&this.buildLastAndHaveCall(t.catchStatement),t.finallyStatement&&this.buildLastAndHaveCall(t.finallyStatement)}else e.next&&(null===(t=e.next)||void 0===t||t.lasts.push(e),this.buildLastAndHaveCall(e.next))}resetWalked(){for(let e of this.statementArray)e.walked=!1}resetWalkedPartial(e){if(e.walked)if(e.walked=!1,"ifStatement"==e.type||"loopStatement"==e.type||"catchOrNot"==e.type){let t=e;if(null==t.nextT||null==t.nextF)return void this.errorTest(t);this.resetWalkedPartial(t.nextF),this.resetWalkedPartial(t.nextT)}else if("switchStatement"==e.type){let t=e;for(let e in t.nexts)this.resetWalkedPartial(t.nexts[e])}else if("tryStatement"==e.type){let t=e;t.tryFirst&&this.resetWalkedPartial(t.tryFirst),t.catchStatement&&this.resetWalkedPartial(t.catchStatement),t.finallyStatement&&this.resetWalkedPartial(t.finallyStatement)}else null!=e.next&&this.resetWalkedPartial(e.next)}CfgBuilder2Array(e){if(e.walked)if(e.walked=!1,e.index=this.statementArray.length,e.type.includes(" exit")||this.statementArray.push(e),"ifStatement"==e.type||"loopStatement"==e.type||"catchOrNot"==e.type){let t=e;if(null==t.nextT||null==t.nextF)return void this.errorTest(t);this.CfgBuilder2Array(t.nextF),this.CfgBuilder2Array(t.nextT)}else if("switchStatement"==e.type){let t=e;for(let e of t.nexts)this.CfgBuilder2Array(e)}else if("tryStatement"==e.type){let t=e;t.tryFirst&&this.CfgBuilder2Array(t.tryFirst),t.catchStatement&&this.CfgBuilder2Array(t.catchStatement),t.finallyStatement&&this.CfgBuilder2Array(t.finallyStatement)}else null!=e.next&&this.CfgBuilder2Array(e.next)}getDotEdges(e){if(0==this.statementArray.length&&this.CfgBuilder2Array(this.entry),!e.walked)if(e.walked=!0,"ifStatement"==e.type||"loopStatement"==e.type||"catchOrNot"==e.type){let t=e;if(null==t.nextT||null==t.nextF)return void this.errorTest(t);let s=[t.index,t.nextF.index];this.dotEdges.push(s),s=[t.index,t.nextT.index],this.dotEdges.push(s),this.getDotEdges(t.nextF),this.getDotEdges(t.nextT)}else if("switchStatement"==e.type){let t=e;for(let e of t.nexts){let s=[t.index,e.index];this.dotEdges.push(s),this.getDotEdges(e)}}else if(null!=e.next){let t=[e.index,e.next.index];this.dotEdges.push(t),this.getDotEdges(e.next)}}generateDot(){this.resetWalked(),this.getDotEdges(this.entry);const e=this.name+".dot";let t="digraph G {\n";for(let e of this.statementArray)"entry"==e.type||"exit"==e.type?t+="Node"+e.index+' [label="'+e.type.replace(/"/g,'\\"')+'"];\n':t+="Node"+e.index+' [label="'+e.code.replace(/"/g,'\\"')+'"];\n';for(let e of this.dotEdges)t+="Node"+e[0]+" -> Node"+e[1]+";\n";t+="}",r.writeFile(e,t,(e=>{e&&console.error(`Error writing to file: ${e.message}`)}))}dfsUseDef(e,t,s){let i=new Set;if("use"==s?i=e.use:"def"==s&&(i=e.def),"Identifier"==t.kind)for(let n of this.variables)if(n.name==t.text){if(i.add(n),"use"==s){let t=new Ut(n.lastDef,e);n.defUse.push(t)}else{n.lastDef=e;for(let t of n.properties)t.lastDef=e}return}if("PropertyAccessExpression"==t.kind)for(let n of this.variables)if(n.name==t.children[0].text){if("use"==s){for(let s of this.variables)if(s.name==t.text){i.add(s);let t=new Ut(s.lastDef,e);return s.defUse.push(t),void(s.lastDef==n.lastDef&&(i.add(n),t=new Ut(n.lastDef,e),n.defUse.push(t)))}i.add(n);let s=new Ut(n.lastDef,e);n.defUse.push(s)}else{for(let s of this.variables)if(s.name==t.text)return void(s.lastDef=e);const s=new Vt(t.text,e);this.variables.push(s);for(let e of this.variables)e.name==t.children[0].text&&(e.properties.push(s),s.propOf=e)}return}let n=-1;"VariableDeclaration"==t.kind&&(n=0,this.dfsUseDef(e,t.children[n],"def")),"BinaryExpression"==t.kind&&"FirstAssignment"==t.children[1].kind&&(n=0),"BinaryExpression"==t.kind&&"FirstAssignment"==t.children[1].kind&&(n=0);for(let i=0;i<t.children.length;i++){if(i==n)continue;let r=t.children[i];this.dfsUseDef(e,r,s)}for(let s=0;s<t.children.length;s++){let i=t.children[s];"FirstAssignment"==i.kind&&(s>=2&&"ColonToken"==t.children[s-2].kind?(n=s-3,this.dfsUseDef(e,t.children[n],"def")):(n=s-1,this.dfsUseDef(e,t.children[n],"def"))),i.kind.includes("EqualsToken")&&"EqualsEqualsToken"!=i.kind?this.dfsUseDef(e,t.children[s-1],"def"):"PlusPlusToken"!=i.kind&&"MinusMinusToken"!=i.kind||(0==s?this.dfsUseDef(e,t.children[s+1],"def"):this.dfsUseDef(e,t.children[s-1],"def"))}}findChildIndex(e,t){for(let s=0;s<e.children.length;s++)if(e.children[s].kind==t)return s;return-1}generateUseDef(){var e,t;for(let s of this.statementArray){if(null==s.astNode)continue;let i=s.astNode,n=s.astNode;switch(null===(e=s.astNode)||void 0===e?void 0:e.kind){case"FirstStatement":case"VariableStatement":let e=n.children[this.findChildIndex(n,"VariableDeclarationList")];e=e.children[this.findChildIndex(e,"SyntaxList")];for(let i of e.children)if(i.children[0]){const e=new Vt(null===(t=i.children[0])||void 0===t?void 0:t.text,s);this.variables.push(e),this.dfsUseDef(s,i,"use")}break;case"ImportDeclaration":let r=n.children[this.findChildIndex(n,"ImportClause")].children[0];if("NamedImports"==r.kind){let e=r.children[this.findChildIndex(r,"SyntaxList")];for(let t of e.children){if("ImportSpecifier"!=t.kind)continue;const e=new Vt(t.text,s);this.variables.push(e),s.def.add(e)}}else if("NamespaceImport"==r.kind){let e=r.children[this.findChildIndex(r,"Identifier")];const t=new Vt(e.text,s);this.variables.push(t),s.def.add(t)}break;case"IfStatement":case"WhileStatement":case"DoStatement":for(let e of i.children)if("Identifier"==e.kind)for(let t of this.variables)t.name==e.text&&s.use.add(t);else"BinaryExpression"==e.kind&&this.dfsUseDef(s,e,"use");break;case"ForStatement":let o=0,a=new Set;for(let e of i.children){if("SemicolonToken"==e.kind&&(o++,2==o&&(a=new Set(s.def))),"Block"==e.kind)break;this.dfsUseDef(s,e,"use")}for(let e of s.def)a.has(e)||s.defspecial.add(e);break;case"ForInStatement":let l=this.findChildIndex(i,"InKeyword");this.dfsUseDef(s,i.children[l+1],"use"),this.dfsUseDef(s,i.children[l-1],"use");break;case"ForOfStatement":let h=this.findChildIndex(i,"LastContextualKeyword");this.dfsUseDef(s,i.children[h+1],"use"),this.dfsUseDef(s,i.children[h-1],"use");break;default:"entry"!=s.type&&"exit"!=s.type&&this.dfsUseDef(s,i,"use")}}}getChild(e,t){for(let s=0;s<e.children.length;s++)if(e.children[s].kind==t)return e.children[s];return null}needExpansion(e){let t=e.kind;return"PropertyAccessExpression"==t||"CallExpression"==t}support(e){let t=e.kind;return"ImportDeclaration"!=t&&"TypeAliasDeclaration"!=t}getSyntaxListItems(e){let t=[];for(const s of e.children)"CommaToken"!=s.kind&&t.push(s);return t}nopStmt(e){let t=e.kind;return"BinaryExpression"==t||"VoidExpression"==t}shouldBeConstant(e){let t=e.kind;return!!("FirstTemplateToken"==t||t.includes("Literal")&&"ArrayLiteralExpression"!=t&&"ObjectLiteralExpression"!=t||"NullKeyword"==t||"TrueKeyword"==t||"FalseKeyword"==t)}getOriginalLocal(e,t=!0){let s=e.getName();for(const e of this.locals)if(e.getName()==s)return e;return t&&this.locals.add(e),e}generateTempValue(){let e="$temp"+this.tempVariableNum;this.tempVariableNum++;let t=new te(e);return this.locals.add(t),t}generateAssignStmt(e){let t,s=this.generateTempValue();return t=e instanceof mt?this.astNodeToValue(e):e,this.current3ACstm.threeAddressStmts.push(new ye(s,t)),s}objectLiteralNodeToLocal(e){let t="AnonymousClass$"+this.name+"$"+this.anonymousClassIndex;this.anonymousClassIndex++;let s=new Jt;s.setName(t);let i=this.declaringClass.getDeclaringArkFile();s.setDeclaringArkFile(i),s.setLine(e.line+1),s.setColumn(e.character+1),s.genSignature(),i.addArkClass(s);const n=s.getSignature(),r=new I(n);let o=new z(r),a=this.generateAssignStmt(o),l=new Oe;l.setMethodName("constructor");let h=new Be;h.setDeclaringClassSignature(n),h.setMethodSubSignature(l);return this.current3ACstm.threeAddressStmts.push(new xe(new _(a,h,[]))),a}templateSpanNodeToValue(e){let t=e.children[0],s=this.astNodeToValue(t),i=e.children[1],n=i.text,r="";if(r="TemplateMiddle"==i.kind?n.substring(1,n.length-2):n.substring(1,n.length-1),0==r.length)return s;let o=new H(s,new kt(r,S.getInstance()),"+");return this.generateAssignStmt(o)}astNodeToTemplateExpr(e){let t=[],s=e.children[0].text;t.push(new kt(s.substring(1,s.length-2),S.getInstance()));let i=e.children[1];for(const e of i.children)t.push(this.templateSpanNodeToValue(e));let n=new H(t[0],t[1],"+"),r=this.generateAssignStmt(n);for(let e=2;e<t.length;e++)n=new H(r,t[e],"+"),r=this.generateAssignStmt(n);return r}astNodeToConditionExpr(e){let t,s=this.astNodeToValue(e);var i;return s instanceof H&&("<"==(i=s.getOperator())||"<="==i||">"==i||">="==i||"=="==i||"==="==i||"!="==i||"!=="==i)?t=new Q(s.getOp1(),s.getOp2(),function(e){let t="";switch(e){case"<":t=">=";break;case"<=":t=">";break;case">":t="<=";break;case">=":t="<";break;case"==":t="!=";break;case"===":t="!==";break;case"!=":t="==";break;case"!==":t="==="}return t}(s.getOperator())):(Pt.moreThanOneAddress(s)&&(s=this.generateAssignStmt(s)),t=new Q(s,new kt("0",m.getInstance()),"==")),t}astNodeToValue(e){let t;if("Identifier"==e.kind||"ThisKeyword"==e.kind||"SuperKeyword"==e.kind)t=new te(e.text),t=this.getOriginalLocal(t);else if("Parameter"==e.kind){let s=e.children[0];e.children[2],t=new te(s.text),t=this.getOriginalLocal(t)}else if(this.shouldBeConstant(e)){const s=this.resolveKeywordType(e);let i=new kt(e.text,ze.buildTypeFromStr(s));t=this.generateAssignStmt(i)}else if("BinaryExpression"==e.kind){let s=this.astNodeToValue(e.children[0]),i=e.children[1].text,n=this.astNodeToValue(e.children[2]);Pt.moreThanOneAddress(s)&&(s=this.generateAssignStmt(s)),Pt.moreThanOneAddress(n)&&(n=this.generateAssignStmt(n)),t=new H(s,n,i)}else if("PropertyAccessExpression"==e.kind){let s=this.astNodeToValue(e.children[0]);Pt.moreThanOneAddress(s)&&(s=this.generateAssignStmt(s));let i=s,n=e.children[2].text;const r=new Me;r.setFieldName(n),t=new oe(i,r)}else if("ElementAccessExpression"==e.kind){let s=this.astNodeToValue(e.children[0]);s instanceof te||(s=this.generateAssignStmt(s));let i=this.findChildIndex(e,"OpenBracketToken")+1,n=this.astNodeToValue(e.children[i]);if(Pt.moreThanOneAddress(n)&&(n=this.generateAssignStmt(n)),n instanceof kt)if(n.getValue().startsWith("'")){let e=n.getValue();n.setValue(e.substring(1,e.length-1))}else if(n.getValue().startsWith('"')){let e=n.getValue();n.setValue(e.substring(2,e.length-2))}let r=s;if(r.getType()instanceof F)t=new ne(r,n);else{let e=n.toString();const s=new Me;s.setFieldName(e),t=new oe(r,s)}}else if("CallExpression"==e.kind){let s=e.children[this.findChildIndex(e,"OpenParenToken")+1],i=this.getSyntaxListItems(s),n=[];for(const e of i){let t=this.astNodeToValue(e);Pt.moreThanOneAddress(t)&&(t=this.generateAssignStmt(t)),n.push(t)}let r=e.children[0],o=this.astNodeToValue(r),a=new ve,l=new Oe,h=new Be;if(h.setDeclaringClassSignature(a),h.setMethodSubSignature(l),o instanceof oe){let e=o.getFieldName(),s=o.getBase();l.setMethodName(e),t=new _(s,h,n)}else o instanceof ae?(l.setMethodName(o.getFieldName()),t=new G(h,n)):(l.setMethodName(r.text),t=new G(h,n))}else if("ArrowFunction"==e.kind){let s="AnonymousFunc$"+this.name+"$"+this.anonymousFuncIndex;if(!e.methodNodeInfo)throw new Error("No MethodNodeInfo found for ArrowFunction node. Please check.");e.methodNodeInfo.updateName4anonymousFunc(s),this.anonymousFuncIndex++;let i=e.children[1],n=[];for(let e of i.children)"CommaToken"!=e.kind&&n.push(this.astNodeToValue(e));let r=new $t;Ht(e,this.declaringClass,r),r.genSignature(),this.declaringClass.addMethod(r);let o=new C(r.getSignature());t=new te(s,o),this.locals.add(t)}else if("FunctionExpression"==e.kind){let s="";if("OpenParenToken"!=e.children[1].kind?s=e.children[1].text:(s="AnonymousFunc-"+this.name+"-"+this.anonymousFuncIndex,this.anonymousFuncIndex++),!e.methodNodeInfo)throw new Error("No MethodNodeInfo found for ArrowFunction node. Please check.");e.methodNodeInfo.updateName4anonymousFunc(s);let i=this.getChild(e,"SyntaxList"),n=[];for(let e of i.children)"CommaToken"!=e.kind&&n.push(this.astNodeToValue(e));let r=new $t;Ht(e,this.declaringClass,r),r.genSignature(),this.declaringClass.addMethod(r);let o=new C(r.getSignature());t=new te(s,o),this.locals.add(t)}else if("ClassExpression"==e.kind){let s=new Jt,i=this.declaringClass.getDeclaringArkFile();if(Zt(e,i,s),i.addArkClass(s),s.isExported()){let e=s.getName(),t="Class",n=new ct;n.build(e,t),i.addExportInfos(n)}t=new te(s.getName(),new I(s.getSignature()))}else if("ObjectLiteralExpression"==e.kind)t=this.objectLiteralNodeToLocal(e);else if("NewExpression"==e.kind){const s=e.children[1].text;if("Array"==s){let s=d.getInstance();if(-1!=this.findChildIndex(e,"FirstBinaryOperator")){const t=e.children[this.findChildIndex(e,"FirstBinaryOperator")+1];s=this.getTypeNode(t)}let i=0,n=null;const r=e.children[this.findChildIndex(e,"OpenParenToken")+1],o=this.getSyntaxListItems(r),a=[];if(1==o.length&&"FirstLiteralToken"==o[0].kind)i=parseInt(o[0].text);else if(1==o.length&&"Identifier"==o[0].kind)i=-1,n=this.getOriginalLocal(new te(o[0].text),!1);else if(o.length>=1){i=o.length,s==d.getInstance()&&(s=ze.buildTypeFromStr(this.resolveKeywordType(o[0])));for(const e of o)a.push(new kt(e.text,s))}null==n&&(n=new kt(i.toString(),m.getInstance()));let l=new $(s,n);t=this.generateAssignStmt(l),t.setType(new A(s,1));for(let e=0;e<a.length;e++){let s=new ne(t,new kt(e.toString(),m.getInstance()));const i=a[e];this.current3ACstm.threeAddressStmts.push(new ye(s,i))}}else{let i=new ve;i.setClassName(s);const n=new I(i);let r=new z(n);t=this.generateAssignStmt(r);let o=new Oe;o.setMethodName("constructor");let a=new Be;a.setDeclaringClassSignature(i),a.setMethodSubSignature(o);let l=e.children[this.findChildIndex(e,"OpenParenToken")+1],h=this.getSyntaxListItems(l),c=[];for(const e of h)c.push(this.astNodeToValue(e));this.current3ACstm.threeAddressStmts.push(new xe(new _(t,a,c)))}}else if("ArrayLiteralExpression"==e.kind){let s=e.children[1],i=0;for(const e of s.children)"CommaToken"!=e.kind&&(i+=1);let n=new $(u.getInstance(),new kt(i.toString(),m.getInstance()));t=this.generateAssignStmt(n);const r=new Set;let o=e.children[1],a=0;for(let e of o.children)if("CommaToken"!=e.kind){let s=new ne(t,new kt(a.toString(),m.getInstance()));const i=this.resolveKeywordType(e),n=ze.buildTypeFromStr(i),o=new kt(e.text,n);r.add(n),this.current3ACstm.threeAddressStmts.push(new ye(s,o)),a++}1==r.size?n.setBaseType(r.keys().next().value):r.size>1&&n.setBaseType(new N(Array.from(r.keys()))),t.setType(new F(n.getBaseType(),1))}else if("PrefixUnaryExpression"==e.kind){let s=e.children[0].text;if("++"==s||"--"==s){t=this.astNodeToValue(e.children[1]);let i=new H(t,new kt("1",m.getInstance()),s[0]);this.current3ACstm.threeAddressStmts.push(new ye(t,i))}else{let i=this.astNodeToValue(e.children[1]),n=new ee(i,s);t=this.generateAssignStmt(n)}}else if("PostfixUnaryExpression"==e.kind){let s=e.children[1].text;t=this.astNodeToValue(e.children[0]);let i=new H(t,new kt("1",m.getInstance()),s[0]);this.current3ACstm.threeAddressStmts.push(new ye(t,i))}else if("TemplateExpression"==e.kind)t=this.astNodeToTemplateExpr(e);else if("AwaitExpression"==e.kind)t=this.astNodeToValue(e.children[1]);else if("ParenthesizedExpression"==e.kind){const s=this.astNodeToValue(e.children[1]);t=this.generateAssignStmt(s)}else if("SpreadElement"==e.kind)t=this.astNodeToValue(e.children[1]);else if("TypeOfExpression"==e.kind)t=new q(this.astNodeToValue(e.children[1]));else if("AsExpression"==e.kind){let s=e.children[2].text,i=this.astNodeToValue(e.children[0]);t=new Y(i,ze.buildTypeFromStr(s))}else if("TypeAssertionExpression"==e.kind){let s=e.children[this.findChildIndex(e,"FirstBinaryOperator")+1].text,i=e.children[this.findChildIndex(e,"GreaterThanToken")+1],n=this.astNodeToValue(i);t=new Y(n,ze.buildTypeFromStr(s))}else if("ArrayBindingPattern"==e.kind||"ObjectBindingPattern"==e.kind)t=this.generateTempValue();else if("VoidExpression"==e.kind)this.astNodeToThreeAddressStmt(e.children[1]),t=new kt("undefined",y.getInstance());else if("VariableDeclarationList"==e.kind){let s=e.children[this.findChildIndex(e,"SyntaxList")],i=this.getSyntaxListItems(s);t=new te(i[0].text),t=this.getOriginalLocal(t)}else if("ConditionalExpression"==e.kind){let s=this.findChildIndex(e,"QuestionToken")-1,i=e.children[s],n=this.astNodeToConditionExpr(i);this.current3ACstm.threeAddressStmts.push(new Ne(n));let r=this.generateTempValue(),o=this.findChildIndex(e,"QuestionToken")+1,a=e.children[o];this.current3ACstm.threeAddressStmts.push(new ye(r,this.astNodeToValue(a)));let l=this.findChildIndex(e,"ColonToken")+1,h=e.children[l];this.current3ACstm.threeAddressStmts.push(new ye(r,this.astNodeToValue(h))),t=r}else t="NonNullExpression"==e.kind?this.astNodeToValue(e.children[0]):new kt(e.text);return t}astNodeToCompoundAssignment(e){let t=e.children[1].text;if(!function(e){return"+="==e||"-="==e||"*="==e||"**="==e||"/="==e||"%="==e||">>="==e||">>>="==e||"<<="==e}(t))return[];let s=[],i=e.children[0],n=this.astNodeToValue(i),r=e.children[2],o=this.astNodeToValue(r);return Pt.moreThanOneAddress(n)&&Pt.moreThanOneAddress(o)&&(o=this.generateAssignStmt(o)),s.push(new ye(n,new H(n,o,t.substring(0,t.length-1)))),s}astNodeToThreeAddressAssignStmt(e){let t,s=e.children[0],i=this.astNodeToValue(s),n=this.getTypeNode(e),r=new mt(void 0,null,[],"dummy",-1,"dummy");-1!=this.findChildIndex(e,"FirstAssignment")?(r=e.children[this.findChildIndex(e,"FirstAssignment")+1],t=this.astNodeToValue(r)):t=new kt("undefined",y.getInstance()),i instanceof te&&i.setType(n),Pt.moreThanOneAddress(i)&&Pt.moreThanOneAddress(t)&&(t=this.generateAssignStmt(t));let o=[];if(o.push(new ye(i,t)),ze.inferTypeInStmt(o[0],null),"ArrayBindingPattern"==s.kind||"ObjectBindingPattern"==s.kind){let e=this.getSyntaxListItems(s.children[1]),t=0;for(const s of e){let e=new ne(i,new kt(t.toString(),m.getInstance())),n=new kt(s.text);o.push(new ye(n,e)),t++}}return o}astNodeToThreeAddressSwitchStatement(e){let t=e.children[this.findChildIndex(e,"OpenParenToken")+1],s=this.astNodeToValue(t);Pt.moreThanOneAddress(s)&&(s=this.generateAssignStmt(s));let i=e.children[this.findChildIndex(e,"CloseParenToken")+1].children[1],n=[];for(const e of i.children){if("DefaultClause"==e.kind)continue;let t=e.children[1],s=this.astNodeToValue(t);Pt.moreThanOneAddress(s)&&(s=this.generateAssignStmt(s)),n.push(s)}this.current3ACstm.threeAddressStmts.push(new Fe(s,n))}astNodeToThreeAddressIterationStatement(e){if("ForStatement"==e.kind){let t=this.findChildIndex(e,"OpenParenToken"),s=t+3;if("SemicolonToken"!=e.children[t+1].kind){let s=e.children[t+1];this.astNodeToThreeAddressStmt(s)}else s=t+2;let i=s+2;if("SemicolonToken"!=e.children[s].kind){let t=e.children[s],i=this.astNodeToConditionExpr(t);this.current3ACstm.threeAddressStmts.push(new Ne(i))}else i=s+1;if("SemicolonToken"!=e.children[i].kind){let t=e.children[i];this.astNodeToThreeAddressStmt(t)}}else if("ForOfStatement"==e.kind){let t=this.findChildIndex(e,"OpenParenToken")+1,s=e.children[t],i=t+2,n=e.children[i],r=this.astNodeToValue(n),o=this.generateTempValue();this.current3ACstm.threeAddressStmts.push(new ye(o,new X(r)));let a=this.generateTempValue();this.current3ACstm.threeAddressStmts.push(new ye(a,new kt("0",m.getInstance())));let l=this.astNodeToValue(s),h=new ne(r,a);this.current3ACstm.threeAddressStmts.push(new ye(l,h));let c=new Q(a,o," >= ");this.current3ACstm.threeAddressStmts.push(new Ne(c));let d=new H(a,new kt("1",m.getInstance()),"+");this.current3ACstm.threeAddressStmts.push(new ye(a,d)),this.current3ACstm.threeAddressStmts.push(new ye(l,h))}else if("ForInStatement"==e.kind){let t=this.findChildIndex(e,"OpenParenToken")+1,s=e.children[t],i=t+2,n=e.children[i],r=this.astNodeToValue(n),o=this.generateTempValue();this.current3ACstm.threeAddressStmts.push(new ye(o,new X(r)));let a=this.generateTempValue();this.current3ACstm.threeAddressStmts.push(new ye(a,new kt("0",m.getInstance())));let l=this.astNodeToValue(s);this.current3ACstm.threeAddressStmts.push(new ye(l,a));let h=new Q(a,o," >= ");this.current3ACstm.threeAddressStmts.push(new Ne(h));let c=new H(a,new kt("1",m.getInstance()),"+");this.current3ACstm.threeAddressStmts.push(new ye(a,c)),this.current3ACstm.threeAddressStmts.push(new ye(l,a))}else if("WhileStatement"==e.kind||"DoStatement"==e.kind){let t=this.findChildIndex(e,"OpenParenToken")+1,s=e.children[t],i=this.astNodeToConditionExpr(s);this.current3ACstm.threeAddressStmts.push(new Ne(i))}}astNodeToThreeAddressStmt(e){let t=[];if("ReturnStatement"==e.kind){if(e.children.length>1&&"SemicolonToken"!=e.children[1].kind){let s=this.astNodeToValue(e.children[1]);Pt.moreThanOneAddress(s)&&(s=this.generateAssignStmt(s)),t.push(new we(s))}else t.push(new Ce)}else if("FirstStatement"==e.kind||"VariableDeclarationList"==e.kind){let t=e;"FirstStatement"==e.kind&&(t=e.children[this.findChildIndex(e,"VariableDeclarationList")]);let s=t.children[this.findChildIndex(t,"SyntaxList")],i=this.getSyntaxListItems(s);for(let e of i)this.astNodeToThreeAddressStmt(e)}else if("BinaryExpression"==e.kind&&"FirstAssignment"==e.children[1].kind||"VariableDeclaration"==e.kind)t.push(...this.astNodeToThreeAddressAssignStmt(e));else if("BinaryExpression"==e.kind)t.push(...this.astNodeToCompoundAssignment(e));else if("ExpressionStatement"==e.kind){let t=0;"JSDocComment"==e.children[0].kind&&(t=1);let s=e.children[t];this.astNodeToThreeAddressStmt(s)}else if("IfStatement"==e.kind){let s=e.children[this.findChildIndex(e,"OpenParenToken")+1],i=this.astNodeToConditionExpr(s);t.push(new Ne(i))}else if("PostfixUnaryExpression"==e.kind||"PrefixUnaryExpression"==e.kind)this.astNodeToValue(e);else if("ForStatement"==e.kind||"ForOfStatement"==e.kind||"ForInStatement"==e.kind||"WhileStatement"==e.kind||"DoStatement"==e.kind)this.astNodeToThreeAddressIterationStatement(e);else if("BreakStatement"==e.kind||"ContinueStatement"==e.kind)t.push(new Te);else if("SwitchStatement"==e.kind)this.astNodeToThreeAddressSwitchStatement(e);else if("ThrowStatement"==e.kind){let s=this.astNodeToValue(e.children[1]);Pt.moreThanOneAddress(s)&&(s=this.generateAssignStmt(s)),t.push(new Ee(s))}else if("CatchClause"==e.kind){let s=e.children[this.findChildIndex(e,"OpenParenToken")+1],i=new te(s.text);i=this.getOriginalLocal(i);let n=new ce(u.getInstance());t.push(new ye(i,n))}else if("CallExpression"==e.kind)t.push(new xe(this.astNodeToValue(e)));else if("AwaitExpression"==e.kind){let t=e.children[1];this.astNodeToThreeAddressStmt(t)}else if("VoidExpression"==e.kind)this.astNodeToThreeAddressStmt(e.children[1]);else if("DeleteExpression"==e.kind){let s=e.children[1],i=this.astNodeToValue(s);t.push(new Ae(i))}else this.nopStmt(e);this.current3ACstm.threeAddressStmts.push(...t)}transformToThreeAddress(){if(this.blocks.length>0&&this.blocks[0].stms.length>0){this.current3ACstm=this.blocks[0].stms[0];let e=0;for(const t of this.declaringMethod.getParameters()){let s=new le(e,t.getType()),i=this.generateAssignStmt(s);i.setName(t.getName()),e++,this.paraLocals.push(i)}let t=new he(this.declaringClass.getSignature().getType());this.thisLocal=this.generateAssignStmt(t),this.thisLocal.setName("this"),this.thisLocal.setType(t.getType())}for(let e=0;e<this.blocks.length;e++){let t=this.blocks[e];for(const e of t.stms)e.astNode&&""!=e.code&&this.support(e.astNode)?(this.current3ACstm=e,this.astNodeToThreeAddressStmt(e.astNode)):e.code.startsWith("return")?e.threeAddressStmts.push(new Ce):"gotoStatement"==e.type&&e.threeAddressStmts.push(new Te)}}errorTest(e){var t,s;let i="";throw i=(null===(t=this.declaringClass)||void 0===t?void 0:t.getDeclaringArkFile())?(null===(s=this.declaringClass)||void 0===s?void 0:s.getDeclaringArkFile().getName())+"."+this.declaringClass.getName()+"."+this.name:"ifnext error",i+="\n"+e.code,new Kt(i)}updateParentText(e){if(e){e.text="";for(let t of e.children)e.text+=t.text,t.kind.includes("Keyword")&&(e.text+=" "),"SyntaxList"==e.kind&&t.kind.includes("Statement")&&(e.text+="\r\n");e.parent&&this.updateParentText(e.parent)}}insertStatementAfter(e,t){var s;let i,n=new St(t);(null===(s=e.astNode)||void 0===s?void 0:s.parent)?i=e.astNode.parent:(this.entry.astNode||(Dt.error("entry without astNode"),process.exit()),i=this.entry.astNode);let r=-1;r=e.astNode?i.children.indexOf(e.astNode)+1:i.children.length;let o=n.root.children[0];return i.children.splice(r,0,o),o.parent=i,this.updateParentText(i),o}insertStatementBefore(e,t){var s;let i,n=new St(t);(null===(s=e.astNode)||void 0===s?void 0:s.parent)?i=e.astNode.parent:(this.entry.astNode||(Dt.error("entry without astNode"),process.exit()),i=this.entry.astNode);let r=-1;r=e.astNode?i.children.indexOf(e.astNode):i.children.length;let o=n.root.children[0];return i.children.splice(r,0,o),o.parent=i,this.updateParentText(i),o}removeStatement(e){let t=e.astNode;t&&t.parent&&(t.parent.children.splice(t.parent.children.indexOf(t),1),this.updateParentText(t.parent))}getStatementByText(e){const t=[];for(let s of this.statementArray)s.code.replace(/\s/g,"")==e.replace(/\s/g,"")&&t.push(s);return t}stm23AC(e){if(e.addressCode3.length>0)if(e.type.includes("loop")||e.type.includes("if")||e.type.includes("switch")){let t=new mt(void 0,null,[],"temp",-1,"undefined");for(let s=0;s<e.addressCode3.length;s++){let i=e.addressCode3[s];t=this.insertStatementBefore(e,i)}e.astNode||(Dt.error("stm without ast"),process.exit());let s=e.astNode.children[this.findChildIndex(e.astNode,"Block")];s.parent=t,t.children[t.children.length-1]=s,this.updateParentText(t),this.removeStatement(e)}else{for(let t=0;t<e.addressCode3.length;t++){let s=e.addressCode3[t];this.insertStatementBefore(e,s)}this.removeStatement(e)}}simplify(){for(let e of this.statementArray)this.stm23AC(e)}printBlocks(){var e,t,s,i,n,r,o;let a="";(null===(e=this.declaringClass)||void 0===e?void 0:e.getDeclaringArkFile())&&(a+=this.declaringClass.getDeclaringArkFile().getName()+"\n");for(let e=0;e<this.blocks.length;e++){let l=this.blocks[e];0!=e&&(a+="label"+l.id+":\n");let h=l.stms.length;for(let c=0;c<h;c++){let d=l.stms[c];if("ifStatement"==d.type||"loopStatement"==d.type||"catchOrNot"==d.type){let t=d;if(null==t.nextT||null==t.nextF)return void this.errorTest(t);if(!t.nextF.block||!t.nextT.block)return void this.errorTest(t);if(d.code="if !("+t.condition+") goto label"+t.nextF.block.id,c==h-1&&e+1<this.blocks.length&&this.blocks[e+1].id!=t.nextT.block.id){let e=new vt("gotoStatement","goto label"+t.nextT.block.id,null,l.stms[0].scopeID);l.stms.push(e),h++}}else if("breakStatement"==d.type||"continueStatement"==d.type){if(!(null===(t=d.next)||void 0===t?void 0:t.block))return void this.errorTest(d);d.code="goto label"+(null===(s=d.next)||void 0===s?void 0:s.block.id)}else if(c==h-1&&(null===(i=d.next)||void 0===i?void 0:i.block)&&(e+1<this.blocks.length&&this.blocks[e+1].id!=d.next.block.id||e+1==this.blocks.length)){let e=new vt("StatementBuilder","goto label"+(null===(n=d.next)||void 0===n?void 0:n.block.id),null,l.stms[0].scopeID);l.stms.push(e),h++}if(0==d.addressCode3.length)a+="    "+d.code+"\n";else for(let e of d.addressCode3)if(e.startsWith("if")||e.startsWith("while")){let t=d,s=e.substring(e.indexOf("(")),i="";(null===(r=t.nextF)||void 0===r?void 0:r.block)&&(i="if !"+s+" goto label"+(null===(o=t.nextF)||void 0===o?void 0:o.block.id)),d.addressCode3[d.addressCode3.indexOf(e)]=i,a+="    "+i+"\n"}else a+="    "+e+"\n"}}for(let e of this.catches)a+="catch "+e.errorName+" from label "+e.from+" to label "+e.to+" with label"+e.withLabel+"\n"}addFirstBlock(){for(let e of this.blocks)e.id+=1;this.blocks.splice(0,0,new Rt(0,[],null))}insertBlockbBefore(e,t){e.splice(t,0,new Rt(0,[],null));for(let s=t;s<e.length;s++)e[s].id+=1}printThreeAddressStmts(){let e=" ".repeat(4),t=";\n",s=[];s.push(...this.blocks);let i=0;for("loopStatement"==s[i].stms[i].type&&(this.insertBlockbBefore(s,i),i=1),i+=1;i<s.length;i++){let e=s[i].stms[0],t=s[i-1].stms[0];"loopStatement"==e.type&&"loopStatement"==t.type&&(this.insertBlockbBefore(s,i),i++)}let n=new Map,r=new Map;for(let e=0;e<s.length;e++){let t=s[e],i=[];for(const e of t.stms)if("ifStatement"==e.type)i.push(...a(e));else if("loopStatement"==e.type)i.push(...l(e));else if("switchStatement"==e.type)i.push(...h(e));else if("breakStatement"==e.type||"continueStatement"==e.type)i.push(...c(e));else for(const t of e.threeAddressStmts)i.push(t.toString());r.set(e,i)}let o="method: "+this.name+" {\n";for(let i=0;i<s.length;i++){let s=[],a=r.get(i);null!=a&&s.push(...a);let l=n.get(i);null!=l&&s.push(...l),0!=i&&(o+="label"+i+":\n"),o+=e,o+=s.join(t+e),o+=t}function a(e){var t,s;let i=e,n=[];for(const e of i.threeAddressStmts)if(e instanceof Ne){let r=null===(s=null===(t=i.nextF)||void 0===t?void 0:t.block)||void 0===s?void 0:s.id;n.push(e.toString()+" goto label"+r)}else n.push(e.toString());return n}function l(e){var t,s,i,r,o,a;let l=e,h=null===(s=null===(t=l.nextT)||void 0===t?void 0:t.block)||void 0===s?void 0:s.id;null==n.get(h)&&n.set(h,[]);let c=n.get(h),d=h-1;null==n.get(d)&&n.set(d,[]);let u=n.get(d),g=[],p=!1,f="ForOfStatement"==(null===(i=l.astNode)||void 0===i?void 0:i.kind)||"ForInStatement"==(null===(r=l.astNode)||void 0===r?void 0:r.kind);for(const e of l.threeAddressStmts)if(e instanceof Ne){let t=null===(a=null===(o=l.nextF)||void 0===o?void 0:o.block)||void 0===a?void 0:a.id;g.push(e.toString()+" goto label"+t),p=!0}else p?e instanceof Te?c.push("goto label"+h):f?(g.push(e.toString()),f=!1):c.push(e.toString()):u.push(e.toString());return g}function h(s){var i,n,r,o;let a=s,l="lookupswitch("+(null===(i=a.astNode)||void 0===i?void 0:i.children[2].text)+"){\n"+e,h=[],c=-1;for(const t of a.cases)h.push(e+t.value+"goto label"+(null===(n=t.stm.block)||void 0===n?void 0:n.id)),c=null===(o=null===(r=t.stm.next)||void 0===r?void 0:r.block)||void 0===o?void 0:o.id;return h.push(e+"default: goto label"+c),l+=h.join(t+e),l+=t+e+"}",[l]}function c(e){var t,s;return["goto label"+(null===(s=null===(t=e.next)||void 0===t?void 0:t.block)||void 0===s?void 0:s.id)]}o+="}\n",Dt.info(o)}printThreeAddressStrs(){Dt.info("#### printThreeAddressStrs ####");for(const e of this.statementArray){Dt.info("------ origin stmt: ",e.code);for(const t of e.addressCode3)Dt.info(t)}}printThreeAddressStrsAndStmts(){for(const e of this.statementArray)if(e.astNode&&e.code){Dt.info("----- origin stmt: ",e.code),Dt.info("-- threeAddressStrs:");for(const t of e.addressCode3)Dt.info(t);Dt.info("-- threeAddressStmts:");for(const t of e.threeAddressStmts)Dt.info(t)}}printOriginStmts(){Dt.info("#### printOriginStmts ####");for(const e of this.statementArray)Dt.info(e)}buildOriginalCfg(){let e=new Tt,t=new Map;for(const s of this.blocks){let i=new Nt;for(const e of s.stms){if(null==e.astNode)continue;let t=new ke;t.setText(e.code),t.setPositionInfo(e.line),t.setOriginPositionInfo(e.line),t.setColumn(e.column),t.setOriginColumn(e.column),i.addStmt(t)}e.addBlock(i),t.set(s,i)}for(const[e,s]of t)for(const i of e.nexts){let e=t.get(i);e.addPredecessorBlock(s),s.addSuccessorBlock(e)}return e}buildCfg(){let e=new Tt;e.declaringClass=this.declaringClass;let t=new Map,s=-1;for(const i of this.blocks){let n=new Nt;for(const t of i.stms)for(const i of t.threeAddressStmts)-1==s&&(s=t.line,e.setStartingStmt(i)),i.setText(i.toString()),i.setOriginPositionInfo(t.line),i.setPositionInfo(s),s++,n.addStmt(i),i.setCfg(e);e.addBlock(n),t.set(i,n)}for(const[e,s]of t)for(const i of e.nexts){let e=t.get(i);e.addPredecessorBlock(s),s.addSuccessorBlock(e)}return e}getLocals(){return this.locals}getTypeNode(e){for(let t of e.children){let e=this.resolveTypeNode(t);if(e!==u.getInstance())return e}return u.getInstance()}resolveTypeNode(e){let t;switch(e.kind){case"BooleanKeyword":case"NumberKeyword":case"StringKeyword":case"VoidKeyword":case"AnyKeyword":return ze.buildTypeFromStr(this.resolveKeywordType(e));case"ArrayType":t=e.children[0];const s=t.text;return new F(ze.buildTypeFromStr(s),1);case"TypeReference":return new M(e.text);case"UnionType":const i=[];t=e.children[0];for(const e of t.children)if("BarToken"!=e.kind){const t=this.resolveTypeNode(e);i.push(t)}return new N(i);case"TupleType":const n=[];t=e.children[1];for(const e of t.children)if("CommaToken"!=e.kind){const t=this.resolveTypeNode(e);n.push(t)}return new E(n);case"TypeQuery":return new O(e.children[1].text)}return u.getInstance()}resolveKeywordType(e){switch(e.kind){case"TrueKeyword":case"FalseKeyword":case"BooleanKeyword":case"FalseKeyword":case"TrueKeyword":return"boolean";case"NumberKeyword":case"FirstLiteralToken":return"number";case"StringKeyword":case"StringLiteral":return"string";case"VoidKeyword":return"void";case"AnyKeyword":return"any";case"NullKeyword":return"null";case"RegularExpressionLiteral":return"RegularExpression";default:return""}}buildCfgBuilder(){this.walkAST(this.entry,this.exit,this.astRoot),this.addReturnInEmptyMethod(),this.deleteExit(this.entry),this.CfgBuilder2Array(this.entry),this.resetWalked(),this.buildLastAndHaveCall(this.entry),this.resetWalked(),this.buildBlocks(this.entry,this.entryBlock),this.blocks=this.blocks.filter((e=>0!=e.stms.length)),this.buildBlocksNextLast(),this.addReturnBlock(),this.resetWalked(),this.transformToThreeAddress()}}class Gt{constructor(e,t,s){this.methodSignature=e,this.cfgBuilder=new _t(t,this.methodSignature.getMethodSubSignature().getMethodName(),s)}build(){let e=this.cfgBuilder.buildCfg();e.buildDefUseStmt();let t=this.cfgBuilder.buildOriginalCfg(),s=new Set(this.cfgBuilder.getLocals());return new bt(this.methodSignature,s,t,e)}}const zt=["MethodDeclaration","Constructor","FunctionDeclaration","GetAccessor","SetAccessor","ArrowFunction","FunctionExpression","MethodSignature","ConstructSignature","CallSignature"];class $t{constructor(){this.line=-1,this.column=-1,this.returnType=u.getInstance(),this.parameters=[],this.modifiers=new Set,this.typeParameters=[]}getName(){return this.name}setName(e){this.name=e}getCode(){return this.code}setCode(e){this.code=e}getLine(){return this.line}setLine(e){this.line=e}getColumn(){return this.column}setColumn(e){this.column=e}setEtsPositionInfo(e){this.etsPosition=e}getEtsPositionInfo(){return de(this,void 0,void 0,(function*(){if(!this.etsPosition){let e=this.declaringArkFile;const t=yield e.getEtsOriginalPositionFor(new Se(this.line,this.column));this.setEtsPositionInfo(t)}return this.etsPosition}))}getDeclaringArkClass(){return this.declaringArkClass}setDeclaringArkClass(e){this.declaringArkClass=e}getDeclaringArkFile(){return this.declaringArkFile}setDeclaringArkFile(){this.declaringArkFile=this.getDeclaringArkClass().getDeclaringArkFile()}isExported(){return this.modifiers.has("ExportKeyword")}isDefaultArkMethod(){return"_DEFAULT_ARK_METHOD"===this.getName()}getParameters(){return this.parameters}addParameter(e){this.parameters.push(e)}getReturnType(){return this.returnType}setReturnType(e){this.returnType=e}getSignature(){return this.methodSignature}setSignature(e){this.methodSignature=e}getSubSignature(){return this.methodSubSignature}setSubSignature(e){this.methodSubSignature=e}genSignature(){let e=new Oe;e.setMethodName(this.name),e.setParameters(this.parameters),e.setReturnType(this.returnType),this.setSubSignature(e);let t=new Be;t.setDeclaringClassSignature(this.declaringArkClass.getSignature()),t.setMethodSubSignature(e),this.setSignature(t)}getModifiers(){return this.modifiers}addModifier(e){this.modifiers.add(e)}getTypeParameter(){return this.typeParameters}addTypeParameter(e){this.typeParameters.push(e)}containsModifier(e){return this.modifiers.has(e)}getBody(){return this.body}setBody(e){this.body=e}getCfg(){return this.body.getCfg()}getOriginalCfg(){return this.body.getOriginalCfg()}getParameterInstances(){let e=this.getCfg().getStmts(),t=[];for(let s of e)if(s instanceof ye&&s.getRightOp()instanceof le&&t.push(s.getLeftOp()),t.length==this.getParameters().length)return t;return t}getThisInstance(){let e=this.getCfg().getStmts();for(let t of e)if(t instanceof ye&&t.getRightOp()instanceof he)return t.getLeftOp();return null}getReturnValues(){let e=[],t=this.getCfg().getStmts();for(let s of t)s instanceof we&&e.push(s.getOp());return e}}function Ht(e,t,s){s.setDeclaringArkClass(t),s.setDeclaringArkFile(),zt.indexOf(e.kind)>-1?Qt(e,s):s.setName("_DEFAULT_ARK_METHOD"),s.genSignature(),"SyntaxList"!=e.kind&&(e=e.children[e.children.length-1].children[1]);let i=new Gt(s.getSignature(),e,s);s.setBody(i.build()),s.getCfg().setDeclaringMethod(s),"render"==s.getName()&&"View"==t.getSuperClassName()&&t.setViewTree(new Et(s))}function Qt(e,t){if(t.setCode(e.text),t.setLine(e.line+1),t.setColumn(e.character+1),!e.methodNodeInfo)throw new Error("Error: There is no methodNodeInfo for this method!");t.setName(e.methodNodeInfo.name),e.methodNodeInfo.modifiers.forEach((e=>{t.addModifier(e)})),e.methodNodeInfo.parameters.forEach((e=>{t.addParameter(e)})),t.setReturnType(e.methodNodeInfo.returnType),e.methodNodeInfo.typeParameters.forEach((e=>{t.addTypeParameter(e)}))}const qt=h.getLogger();class Jt{constructor(){this.originType="Class",this.line=-1,this.column=-1,this.superClassName="",this.extendedClasses=[],this.implementedInterfaceNames=[],this.modifiers=new Set,this.typeParameters=[],this.defaultMethod=null,this.methods=[],this.fields=[]}getName(){return this.name}setName(e){this.name=e}getCode(){return this.code}setCode(e){this.code=e}getLine(){return this.line}setLine(e){this.line=e}getColumn(){return this.column}setColumn(e){this.column=e}setEtsPositionInfo(e){this.etsPosition=e}getEtsPositionInfo(){return de(this,void 0,void 0,(function*(){if(!this.etsPosition){let e=this.declaringArkFile;const t=yield e.getEtsOriginalPositionFor(new Se(this.line,this.column));this.setEtsPositionInfo(t)}return this.etsPosition}))}getOriginType(){return this.originType}setOriginType(e){this.originType=e}getDeclaringArkFile(){return this.declaringArkFile}setDeclaringArkFile(e){this.declaringArkFile=e}getDeclaringArkNamespace(){return this.declaringArkNamespace}setDeclaringArkNamespace(e){this.declaringArkNamespace=e}isExported(){return this.modifiers.has("ExportKeyword")}isDefaultArkClass(){return"_DEFAULT_ARK_CLASS"===this.getName()}getSignature(){return this.classSignature}setSignature(e){this.classSignature=e}genSignature(){let e=new ve;e.setClassName(this.name),e.setDeclaringFileSignature(this.declaringArkFile.getFileSignature()),this.declaringArkNamespace&&e.setDeclaringNamespaceSignature(this.declaringArkNamespace.getNamespaceSignature()),this.setSignature(e)}getSuperClassName(){return this.superClassName}setSuperClassName(e){this.superClassName=e}getSuperClass(){return this.superClass}setSuperClass(e){this.superClass=e}getExtendedClasses(){return this.extendedClasses}addExtendedClass(e){this.extendedClasses.push(e)}getImplementedInterfaceNames(){return this.implementedInterfaceNames}addImplementedInterfaceName(e){this.implementedInterfaceNames.push(e)}hasImplementedInterface(e){return this.implementedInterfaceNames.indexOf(e)>-1}getField(e){let t=null;return this.getFields().forEach((s=>{s.getSignature().toString()==e.toString()&&(t=s)})),t}getFields(){return this.fields}addField(e){this.fields.push(e)}addFields(e){e.forEach((e=>{this.addField(e)}))}getModifiers(){return this.modifiers}addModifier(e){this.modifiers.add(e)}getTypeParameter(){return this.typeParameters}addTypeParameter(e){this.typeParameters.push(e)}containsModifier(e){return this.modifiers.has(e)}getMethods(){return this.methods}getMethod(e){let t=null;return this.methods.forEach((s=>{s.getSignature().toString()==e.toString()&&(t=s)})),t}addMethod(e){this.methods.push(e)}setDefaultArkMethod(e){this.defaultMethod=e,this.addMethod(e)}getDefaultArkMethod(){return this.defaultMethod}setViewTree(e){this.viewTree=e}getViewTree(){return de(this,void 0,void 0,(function*(){return this.hasViewTree()&&!this.viewTree.isInitialized()&&(this.getDeclaringArkFile().getScene().inferTypes(),yield this.viewTree.buildViewTree()),this.viewTree}))}hasViewTree(){return null!=this.viewTree}}function Xt(e,t,s){s.setDeclaringArkFile(t),ts(e,s)}function Yt(e,t,s){s.setDeclaringArkNamespace(t),s.setDeclaringArkFile(t.getDeclaringArkFile()),ts(e,s)}function Zt(e,t,s){s.setDeclaringArkFile(t),s.setCode(e.text),s.setLine(e.line+1),s.setColumn(e.character+1),ss(e,s)}function es(e,t,s){s.setDeclaringArkNamespace(t),s.setDeclaringArkFile(t.getDeclaringArkFile()),s.setCode(e.text),s.setLine(e.line+1),s.setColumn(e.character+1),ss(e,s)}function ts(e,t){t.setName("_DEFAULT_ARK_CLASS"),t.genSignature(),function(e,t){let s=new $t;Ht(e,t,s),t.setDefaultArkMethod(s)}(e,t)}function ss(e,t){var s;if(!e.classNodeInfo)throw new Error("Error: There is no classNodeInfo for this ClassDeclaration!");t.setName(e.classNodeInfo.getClassName()),t.setOriginType(e.classNodeInfo.getOriginType()),t.genSignature(),e.classNodeInfo.getmodifiers().forEach((e=>{t.addModifier(e)}));for(let[s,i]of e.classNodeInfo.getHeritageClauses())"ExtendsKeyword"==i?t.setSuperClassName(s):t.addImplementedInterfaceName(s);t.addFields(e.classNodeInfo.getMembers()),t.getFields().forEach((e=>{e.setDeclaringClass(t),e.genSignature()})),e.classNodeInfo.getTypeParameters().forEach((e=>{t.addTypeParameter(e)}));for(let i of e.children)if("SyntaxList"==i.kind)for(let e of i.children)if(zt.indexOf(e.kind)>-1){let i=new $t;if(Ht(e,t,i),t.addMethod(i),"GetAccessor"==e.kind){let n=null===(s=e.methodNodeInfo)||void 0===s?void 0:s.getAccessorName;n?t.getFields().forEach((e=>{e.getName()===n&&(e.setParameters(i.getParameters()),e.setType(i.getReturnType()),e.setTypeParameters(i.getTypeParameter()),e.setArkMethodSignature(i.getSignature()))})):qt.warn("Cannot get GetAccessorName for method: ",i.getSignature().toString())}}}class is{constructor(){this.line=-1,this.column=-1,this.declaringArkNamespace=null,this.modifiers=new Set,this.exportInfos=[],this.namespaces=[],this.classes=[]}getMethodAllTheNamespace(e){let t=e.getDeclaringClassSignature(),s=this.getClassAllTheNamespace(t);return s?s.getMethod(e):null}getClassAllTheNamespace(e){if(e.getDeclaringFileSignature().toString()!=this.getNamespaceSignature().getDeclaringFileSignature().toString())return null;let t=e.getDeclaringNamespaceSignature();if(t){let s=this.getNamespaceAllTheNamespace(t);if(s)return s.getClassAllTheNamespace(e)}return null}addNamespace(e){this.namespaces.push(e)}getNamespace(e){return this.namespaces.find((t=>t.getNamespaceSignature().toString()==e.toString()))||null}getNamespaceAllTheNamespace(e){let t=null,s=e.getDeclaringNamespaceSignature();if(!s)return null;if(s.toString()==this.namespaceSignature.toString())this.namespaces.forEach((s=>{s.getNamespaceSignature().toString()==e.toString()&&(t=s)}));else{let i=this.getNamespaceAllTheNamespace(s);i&&(t=i.getNamespace(e))}return t}getNamespaces(){return this.namespaces}genNamespaceSignature(){let e=new De;e.setNamespaceName(this.name),e.setDeclaringFileSignature(this.declaringArkFile.getFileSignature()),this.declaringArkNamespace&&e.setDeclaringNamespaceSignature(this.declaringArkNamespace.getNamespaceSignature()),this.namespaceSignature=e}getNamespaceSignature(){return this.namespaceSignature}getName(){return this.name}setName(e){this.name=e}getCode(){return this.code}setCode(e){this.code=e}getLine(){return this.line}setLine(e){this.line=e}getColumn(){return this.column}setColumn(e){this.column=e}setEtsPositionInfo(e){this.etsPosition=e}getEtsPositionInfo(){return de(this,void 0,void 0,(function*(){if(!this.etsPosition){let e=this.declaringArkFile;const t=yield e.getEtsOriginalPositionFor(new Se(this.line,this.column));this.setEtsPositionInfo(t)}return this.etsPosition}))}setDeclaringType(e){this.declaringType=e}getDeclaringType(){return this.declaringType}getDeclaringInstance(){return this.declaringInstance}setDeclaringInstance(e){this.declaringInstance=e}getDeclaringArkFile(){return this.declaringArkFile}setDeclaringArkFile(e){this.declaringArkFile=e}getDeclaringArkNamespace(){return this.declaringArkNamespace}setDeclaringArkNamespace(e){this.declaringArkNamespace=e}getModifiers(){return this.modifiers}addModifier(e){this.modifiers.add(e)}containsModifier(e){return this.modifiers.has(e)}getClass(e){return this.classes.find((t=>t.getSignature().toString()==e.toString()))||null}getClasses(){return this.classes}updateClass(e){for(let t=0;t<this.classes.length;t++)this.classes[t].getSignature().toString()==e.getSignature().toString()&&this.classes.splice(t,1);this.classes.push(e)}addArkClass(e){this.getClass(e.getSignature())?this.updateClass(e):this.classes.push(e)}isExported(){return this.containsModifier("ExportKeyword")}getExportInfos(){return this.exportInfos}addExportInfos(e){this.exportInfos.push(e)}getDefaultClass(){return this.defaultClass}setDefaultClass(e){this.defaultClass=e}getAllMethodsUnderThisNamespace(){let e=[];return this.classes.forEach((t=>{e.push(...t.getMethods())})),this.namespaces.forEach((t=>{e.push(...t.getAllMethodsUnderThisNamespace())})),e}getAllClassesUnderThisNamespace(){let e=[];return e.push(...this.classes),this.namespaces.forEach((t=>{e.push(...t.getAllClassesUnderThisNamespace())})),e}getAllNamespacesUnderThisNamespace(){let e=[];return e.push(...this.namespaces),this.namespaces.forEach((t=>{e.push(...t.getAllNamespacesUnderThisNamespace())})),e}}function ns(e,t,s){if(!e.namespaceNodeInfo)throw new Error("Error: There is no namespaceNodeInfo for this ModuleDeclaration!");s.setName(e.namespaceNodeInfo.getName()),t instanceof hs?(s.setDeclaringType("ArkFile"),s.setDeclaringArkFile(t)):(s.setDeclaringType("ArkNamespace"),s.setDeclaringArkNamespace(t),s.setDeclaringArkFile(t.getDeclaringArkFile())),s.setDeclaringInstance(t),s.genNamespaceSignature(),e.namespaceNodeInfo.getModifiers().forEach((e=>{s.addModifier(e)})),s.setCode(e.text),s.setLine(e.line+1),s.setColumn(e.character+1);let i=rs(e,"ModuleBlock");i&&(i=rs(i,"SyntaxList")),i&&(function(e,t){let s=new Jt;Yt(e,t,s),t.setDefaultClass(s),t.addArkClass(s)}(i,s),function(e,t){var s;for(let i of e.children){if("ModuleDeclaration"==i.kind){let e=new is;if(ns(i,t,e),t.addNamespace(e),e.isExported()){let s=t.getModifiers().has("DefaultKeyword");as(e,t,s)}}if("ClassDeclaration"==i.kind||"InterfaceDeclaration"==i.kind||"EnumDeclaration"==i.kind){let e=new Jt;if(es(i,t,e),t.addArkClass(e),e.isExported()){let s=e.getModifiers().has("DefaultKeyword");as(e,t,s)}}if(zt.indexOf(i.kind)>-1){let e=new $t;if(Ht(i,t.getDefaultClass(),e),t.getDefaultClass().addMethod(e),e.isExported()){let s=e.getModifiers().has("DefaultKeyword");as(e,t,s)}}if("ExportDeclaration"!=i.kind&&"ExportAssignment"!=i.kind||null===(s=i.exportNodeInfo)||void 0===s||s.forEach((e=>{rs(i,"DefaultKeyword")&&e.setDefault(!0),t.addExportInfos(e)})),"VariableStatement"==i.kind||"FirstStatement"==i.kind){let e=rs(i,"SyntaxList"),s=!!rs(i,"DefaultKeyword");e&&rs(e,"ExportKeyword")&&os(i,t,s)}}}(i,s))}function rs(e,t){for(let s of e.children)if(s.kind==t)return s;return null}function os(e,t,s){let i="",n=e.kind,r=rs(e,"VariableDeclarationList");if(r){let e=rs(r,"SyntaxList");if(e){let t=rs(e,"VariableDeclaration");if(t){let e=rs(t,"Identifier");e&&(i=e.text)}}}let o=new ct;o.build(i,n),o.setDefault(s),t.addExportInfos(o)}function as(e,t,s){let i,n=e.getName();i=e instanceof $t?"Method":e instanceof Jt?"Class":"ArkNamespace";let r=new ct;r.build(n,i),r.setDefault(s),t.addExportInfos(r)}const ls=["ModuleDeclaration","ClassDeclaration","InterfaceDeclaration","EnumDeclaration","ExportDeclaration","ExportAssignment","MethodDeclaration","Constructor","FunctionDeclaration","GetAccessor","SetAccessor","ArrowFunction","FunctionExpression","MethodSignature","ConstructSignature","CallSignature"];class hs{constructor(){this.projectName="",this.namespaces=[],this.classes=[],this.importInfos=[],this.exportInfos=[]}setName(e){this.name=e}getName(){return this.name}setScene(e){this.scene=e}getScene(){return this.scene}setProjectDir(e){this.projectDir=e}getProjectDir(){return this.projectDir}getFilePath(){return this.absoluteFilePath}setFilePath(e){this.absoluteFilePath=e}setCode(e){this.code=e}getCode(){return this.code}getAst(){return this.ast}genAst(){this.ast=new St(this.code)}updateClass(e){for(let t=0;t<this.classes.length;t++)this.classes[t].getSignature().toString()==e.getSignature().toString()&&this.classes.splice(t,1);this.classes.push(e)}addArkClass(e){this.getClass(e.getSignature())?this.updateClass(e):this.classes.push(e)}getDefaultClass(){return this.defaultClass}setDefaultClass(e){this.defaultClass=e}getNamespace(e){return this.namespaces.find((t=>t.getNamespaceSignature().toString()==e.toString()))||null}getNamespaces(){return this.namespaces}getClass(e){return this.classes.find((t=>t.getSignature().toString()==e.toString()))||null}getClasses(){return this.classes}addNamespace(e){this.namespaces.push(e)}getMethodAllTheFile(e){let t=null,s=e.getDeclaringClassSignature().getDeclaringNamespaceSignature();if(null!=s){let i=this.getNamespaceAllTheFile(s);i&&(t=i.getMethodAllTheNamespace(e))}else{let s=e.getDeclaringClassSignature(),i=this.getClass(s);i&&(t=i.getMethod(e))}return t}getClassAllTheFile(e){let t=null;if(e.getDeclaringFileSignature().toString()!=this.fileSignature.toString())return null;{let s=e.getDeclaringNamespaceSignature();if(s){let i=this.getNamespaceAllTheFile(s);i&&(t=i.getClass(e))}else t=this.getClass(e)}return t}getNamespaceAllTheFile(e){let t=null,s=e.getDeclaringNamespaceSignature();if(s){let i=this.getNamespaceAllTheFile(s);i&&(t=i.getNamespace(e))}else this.namespaces.forEach((s=>{s.getNamespaceSignature().toString()==e.toString()&&(t=s)}));return t}getImportInfos(){return this.importInfos}addImportInfos(e){this.importInfos.push(e)}getExportInfos(){return this.exportInfos}addExportInfos(e){this.exportInfos.push(e)}setProjectName(e){this.projectName=e}getProjectName(){return this.projectName}genFileSignature(){let e=new Pe;e.setFileName(this.name),e.setProjectName(this.projectName),this.fileSignature=e}getFileSignature(){return this.fileSignature}getAllMethodsUnderThisFile(){let e=[];return this.classes.forEach((t=>{e.push(...t.getMethods())})),this.namespaces.forEach((t=>{e.push(...t.getAllMethodsUnderThisNamespace())})),e}getAllClassesUnderThisFile(){let e=[];return e.push(...this.classes),this.namespaces.forEach((t=>{e.push(...t.getAllClassesUnderThisNamespace())})),e}getAllNamespacesUnderThisFile(){let e=[];return e.push(...this.namespaces),this.namespaces.forEach((t=>{e.push(...t.getAllNamespacesUnderThisNamespace())})),e}initSourceMap(){return de(this,void 0,void 0,(function*(){if(this.sourceMap)return;let e=this.getFilePath()+".map";o.existsSync(e)&&(this.sourceMap=yield new a.SourceMapConsumer(o.readFileSync(e,"utf-8")))}))}getEtsOriginalPositionFor(e){return de(this,void 0,void 0,(function*(){var t;if(e.getColNo()<0||e.getLineNo()<1)return new Se(0,0);yield this.initSourceMap();let s=null===(t=this.sourceMap)||void 0===t?void 0:t.originalPositionFor({line:e.getLineNo(),column:e.getColNo(),bias:a.SourceMapConsumer.LEAST_UPPER_BOUND});return s&&s.line?new Se(s.line,s.column):new Se(0,0)}))}getEtsSource(e){return de(this,void 0,void 0,(function*(){if(e<1)return"";yield this.initSourceMap();let t=this.sourceMap.sources[0];if(!o.existsSync(t))return"";let s=o.readFileSync(t,"utf8").split("\n");return s.length<e?"":s[e-1]}))}}function cs(e,t,s){s.setFilePath(e),s.setProjectDir(t),s.setName(n.relative(t,e)),s.genFileSignature(),s.setCode(o.readFileSync(e,"utf8")),s.genAst(),function(e){let t=new Jt;Xt(e.getAst().root,e,t),e.setDefaultClass(t),e.addArkClass(t)}(s),function(e){var t,s,i;let n=null===(t=e.getAst().root)||void 0===t?void 0:t.children;for(let t of n){if("ModuleDeclaration"==t.kind){let s=new is;if(s.setDeclaringArkFile(e),ns(t,e,s),e.addNamespace(s),s.isExported()){let t=s.getModifiers().has("DefaultKeyword");gs(s,e,t)}}if("ClassDeclaration"==t.kind||"InterfaceDeclaration"==t.kind||"EnumDeclaration"==t.kind){let s=new Jt;if(Zt(t,e,s),e.addArkClass(s),s.isExported()){let t=s.getModifiers().has("DefaultKeyword");gs(s,e,t)}}if(zt.indexOf(t.kind)>-1){let s=new $t;if(Ht(t,e.getDefaultClass(),s),e.getDefaultClass().addMethod(s),s.isExported()){let t=s.getModifiers().has("DefaultKeyword");gs(s,e,t)}}if("ImportDeclaration"!=t.kind&&"ImportEqualsDeclaration"!=t.kind||null===(s=t.importNodeInfo)||void 0===s||s.forEach((t=>{t.setDeclaringFilePath(e.getFilePath()),t.setProjectPath(e.getProjectDir()),t.setDeclaringArkFile(e),t.setImportFromSignature(),e.addImportInfos(t)})),"ExportDeclaration"!=t.kind&&"ExportAssignment"!=t.kind||null===(i=t.exportNodeInfo)||void 0===i||i.forEach((s=>{ds(t,"DefaultKeyword")&&s.setDefault(!0);let i=s.getImportInfo();i&&(i.setDeclaringFilePath(e.getFilePath()),i.setProjectPath(e.getProjectDir()),i.setDeclaringArkFile(e),i.setImportFromSignature(),e.addImportInfos(i)),e.addExportInfos(s)})),"VariableStatement"==t.kind||"FirstStatement"==t.kind){let s=ds(t,"SyntaxList"),i=!!ds(t,"DefaultKeyword");s&&ds(s,"ExportKeyword")&&us(t,e,i)}}}(s)}function ds(e,t){for(let s of e.children)if(s.kind==t)return s;return null}function us(e,t,s){let i="",n=e.kind,r=ds(e,"VariableDeclarationList");if(r){let e=ds(r,"SyntaxList");if(e){let t=ds(e,"VariableDeclaration");if(t){let e=ds(t,"Identifier");e&&(i=e.text)}}}let o=new ct;o.build(i,n),o.setDefault(s),t.addExportInfos(o)}function gs(e,t,s){let i,n=e.getName();i=e instanceof $t?"Method":e instanceof Jt?"Class":"ArkNamespace";let r=new ct;r.build(n,i),r.setDefault(s),t.addExportInfos(r)}h.getLogger();class ps{constructor(){this._workList=[],this._processedList=[]}get workList(){return this._workList}set workList(e){this._workList=e}get processedList(){return this._processedList}set processedList(e){this._processedList=e}findInWorkList(e){return this.workList.find((t=>t===e))}findInProcessedList(e){return void 0!==this.processedList.find((t=>t.toString()===e.toString()))}addToWorkList(e){ms(e,this.workList,((e,t)=>e.toString()===t.toString()))||this.workList.push(e)}addToProcessedList(e){ms(e,this.processedList,((e,t)=>e===t))||this.processedList.push(e)}removeFromWorkList(e){this.workList=this.workList.filter((t=>t!==e))}removeFromProcessedList(e){this.processedList=this.processedList.filter((t=>t.toString()!==e.toString()))}}class fs{get scene(){return this._scene}set scene(e){this._scene=e}getMethod(e){let t=this._scene.getMethod(e);if(null==t){let t=this.scene.getSdkArkFilestMap();for(let s of t.values())if(s.getFileSignature().toString()==e.getDeclaringClassSignature().getDeclaringFileSignature().toString()){const t=s.getAllMethodsUnderThisFile();for(let s of t)if(e.toString()==s.getSignature().toString())return s}}return t}getClass(e){if(void 0===e.getClassName())return null;let t=this._scene.getClass(e);if(null==t){let t=this._scene.getSdkArkFilestMap().get(e.getDeclaringFileSignature().toString());if(null!=t)for(let s of t.getAllClassesUnderThisFile())if(s.getSignature().toString()===e.toString())return s}return t}getExtendedClasses(e){let t=[this.getClass(e)],s=[];for(;t.length>0;){let e=t.shift();if(null==e)continue;let i=e.getExtendedClasses();if(i)for(let e of i)ms(e,s,((e,t)=>e.getSignature().toString()===t.getSignature().toString()))||t.push(e);ms(e,s,((e,t)=>e.getSignature().toString()===t.getSignature().toString()))||s.push(e)}return s}}function ms(e,t,s){for(let i of t)if(s(i,e))return!0;return!1}class Ss{get signatureManager(){return this._signatureManager}get scene(){return this._scene}constructor(e){this.methods=new Set,this.calls=new Map,this._signatureManager=new ps,this._scene=new fs,this._scene.scene=e}loadCallGraph(e){this.processWorkList(e)}processWorkList(e){for(this.signatureManager.workList=e;0!=this.signatureManager.workList.length;){let e=this.signatureManager.workList.shift();if(!this.checkMethodForAnalysis(e))continue;this.preProcessMethod(e);let t=this.processMethod(e);for(let s of t)this.signatureManager.addToWorkList(s),this.addCall(e,s);this.signatureManager.addToProcessedList(e),this.addMethod(e)}}processMethod(e){var t;let s=[],i=null===(t=this.scene.getMethod(e))||void 0===t?void 0:t.getBody().getCfg();if(void 0!==i)for(let t of i.getStmts())if(t.containsInvokeExpr()){let i=this.resolveCall(e,t);for(let e of i)ms(e,s,((e,t)=>e.toString()===t.toString()))||s.push(e)}return s}addMethod(e){null==this.getMethod(e)&&this.methods.add(e)}hasMethod(e){for(let t of this.methods)if(e.toString()===t.toString())return!0;return!1}addCall(e,t){this.getCall(e).length>0?ms(t,this.getCall(e),((e,t)=>e.toString()===t.toString()))||this.calls.get(e).push(t):this.calls.set(e,[t])}getCalls(){return this.calls}getMethods(){return this.methods}getMethod(e){for(const t of this.methods)if(t.toString()===e.toString())return t;return null}getCall(e){for(const[t,s]of this.calls)if(t.toString()===e.toString())return s;return[]}checkMethodForAnalysis(e){if(void 0===e)return!1;if(this.signatureManager.findInProcessedList(e))return!1;return this.scene.scene.arkFiles.some((t=>t.getFileSignature().toString()===e.getDeclaringClassSignature().getDeclaringFileSignature().toString()))}}class ks extends Ss{resolveCall(e,t){let s=null,i=[],n=t.getInvokeExpr();if(void 0===n)return[];let r=this.resolveInvokeExpr(n,e.getDeclaringClassSignature().getDeclaringFileSignature().getFileName(),e);if(null==r)return i;for(let e of r){if(s=e.getSignature(),null==s)return i;if(n instanceof G)return i.push(s),i;{if("constructor"===s.getMethodSubSignature().getMethodName())return i.push(s),i;let e=this.resolveAllCallTargets(s);for(let t of e){let e=this.scene.getMethod(t);null!=e&&(e.getDeclaringArkClass().getModifiers().has("AbstractKeyword")||e.getModifiers().has("AbstractKeyword")||ms(e.getSignature(),i,((e,t)=>e.toString()===t.toString()))||i.push(t))}}}return i}resolveAllCallTargets(e){let t,s=[];t=this.scene.getExtendedClasses(e.getDeclaringClassSignature());for(let i of t){let t=i.getMethods();for(let i of t)i.getSubSignature().toString()===e.getMethodSubSignature().toString()&&(ms(i.getSignature(),s,((e,t)=>e.toString()===t.toString()))||s.push(i.getSignature()))}return s}resolveInvokeExpr(e,t,s){let i=e.getMethodSignature().getMethodSubSignature().getMethodName(),n=[];if(e instanceof _){let t=e.getBase().getType();if(t instanceof I){let e=this.scene.getExtendedClasses(t.getClassSignature());for(let t of e)for(let e of t.getMethods())e.getName()===i&&(ms(e,n,((e,t)=>e.getSignature().toString()===t.getSignature().toString()))||n.push(e))}}else if(e instanceof G){let t=this.scene.getMethod(e.getMethodSignature());null!=t&&(ms(t,n,((e,t)=>e.getSignature().toString()===t.getSignature().toString()))||n.push(t))}return n}preProcessMethod(e){}}class ys extends Ss{constructor(){super(...arguments),this.instancedClasses=new Set,this.ignoredCalls=new Map}resolveCall(e,t){let s,i=[],n=t.getInvokeExpr();if(void 0===n)return[];let r=this.resolveInvokeExpr(n,e.getDeclaringClassSignature().getDeclaringFileSignature().getFileName(),e);if(null==r)return i;for(let t of r){if(s=t.getSignature(),null==s)return i;if(n instanceof G)return i.push(s),i;{if("constructor"===s.getMethodSubSignature().getMethodName())return i.push(s),i;let t=this.resolveAllCallTargets(s);for(let s of t){let t=this.scene.getMethod(s);null!=t&&(t.getDeclaringArkClass().getModifiers().has("AbstractKeyword")||t.getModifiers().has("AbstractKeyword")||(null!==this.getInstancedClass(t.getDeclaringArkClass().getSignature())?ms(t.getSignature(),i,((e,t)=>e.toString()===t.toString()))||i.push(s):this.saveIgnoredCalls(e,t.getSignature())))}}}return i}resolveAllCallTargets(e){let t,s=[];t=this.scene.getExtendedClasses(e.getDeclaringClassSignature());for(let i of t){let t=i.getMethods();for(let i of t)i.getSubSignature().toString()===e.getMethodSubSignature().toString()&&(ms(i.getSignature(),s,((e,t)=>e.toString()===t.toString()))||s.push(i.getSignature()))}return s}preProcessMethod(e){const t=this.collectInstantiatedClassesInMethod(e).filter((e=>!(null!=this.getInstancedClass(e))));for(let e of t){let t=this.getIgnoredCalls(e);if(0!=t.length){for(let e of t)this.addCall(e[0],e[1]),this.signatureManager.addToWorkList(e[1]);this.ignoredCalls.delete(e)}this.addInstancedClass(e)}}collectInstantiatedClassesInMethod(e){let t,s=this.scene.getMethod(e).getCfg();t=[];for(let e of s.getStmts()){let s=e.getExprs()[0];if(s instanceof z){let e=s.getType().getClassSignature();null!=e&&(ms(e,t,((e,t)=>e.toString()===t.toString()))||t.push(e))}}return t}resolveInvokeExpr(e,t,s){let i=e.getMethodSignature().getMethodSubSignature().getMethodName(),n=new Set,r=[];if(e instanceof _){let t=e.getBase().getType();if(t instanceof I){let e=this.scene.getExtendedClasses(t.getClassSignature());for(let t of e)for(let e of t.getMethods())e.getName()===i&&(ms(e,r,((e,t)=>e.getSignature().toString()===t.getSignature().toString()))||r.push(e))}}else if(e instanceof G)if(i.includes(".")){let e=i.lastIndexOf("."),r=i.substring(0,e);if("this"===r){let e=this.scene.getClass(s.getDeclaringClassSignature());n.add([e.getName(),e.getDeclaringArkFile().getName()])}else n.add([r,t]),i.substring(e+1)}else{let t=this.scene.getMethod(e.getMethodSignature());null!=t&&(ms(t,r,((e,t)=>e.getSignature().toString()===t.getSignature().toString()))||r.push(t))}return r}saveIgnoredCalls(e,t){let s=t.getDeclaringClassSignature(),i=this.getIgnoredCalls(s);i.some((s=>s[0].toString()===e.toString()&&s[1].toString()===t.toString()))||(0!=i.length?i.push([e,t]):this.ignoredCalls.set(s,[[e,t]]))}getIgnoredCalls(e){for(let t of this.ignoredCalls.keys())if(t.toString()===e.toString())return this.ignoredCalls.get(t);return[]}deleteIgnoredCalls(e){for(let t of this.ignoredCalls.keys())t.toString()===e.toString()&&this.ignoredCalls.delete(t)}addInstancedClass(e){for(let t of this.instancedClasses)if(t.toString()===e.toString())return;this.instancedClasses.add(e)}getInstancedClass(e){for(let t of this.instancedClasses)if(t.toString()===e.toString())return t;return null}}class xs{constructor(e,t){this.type=e,this.location=t}getType(){return this.type}getLocation(){return this.location}static genLocation(e,t){return e.toString()+t.getOriginPositionInfo()}}class Ns{constructor(e){this.identifier=e,this.pointerTargetSet=new Set}addPointerTarget(e){for(let e of this.pointerTargetSet)if(e.getLocation()==e.getLocation())return;this.pointerTargetSet.add(e)}getIdentifier(){return this.identifier}getPointerTarget(e){for(let t of this.pointerTargetSet)if(t==e)return t;return null}getAllPointerTargets(){let e=[];for(let t of this.pointerTargetSet)e.push(t);return e}static comparePointerTargetSet(e,t){return e.identifier===t.identifier}static calculateDifference(e,t){let s=new Set(e);for(let e of t)s.delete(e);return s}toString(){let e="";this.identifier instanceof te&&(e=this.identifier.getName()+" pointer: {");for(let t of this.pointerTargetSet)e+=" "+t.getType()+"."+t.getLocation();return e+"}"}}class Ts{constructor(e,t){this.pointer=e,this.pointerTarget=t}getPointer(){return this.pointer}getPointerTarget(){return this.pointerTarget}}const ws=h.getLogger();class Cs{constructor(){this.pointerFlowEdges=new Map,this.pointerSet=new Set}proPagate(e,t){const s=[],i=this.getPointerSetElement(e);this.addPointerSetElement(i,t);const n=this.getPointerFlowEdges(i);for(let e of n)s.push(new Ts(e,t));return s}getPointerSet(){return this.pointerSet}getPointerSetElement(e){const t=this.getPointerSet();for(let s of t)if(s.getIdentifier()===e)return s;let s=new Ns(e);return this.pointerSet.add(s),s}addPointerSetElement(e,t){e.addPointerTarget(t)}getPointerFlowEdges(e){return this.pointerFlowEdges.get(e)||[]}addPointerFlowEdge(e,t){let s=[];if(!this.hasPointerFlowEdge(e,t)){const i=this.pointerFlowEdges.get(e)||[];i.push(t),this.pointerFlowEdges.set(e,i);let n=e.getAllPointerTargets();for(let e of n)s.push(new Ts(t,e))}return s}hasPointerFlowEdge(e,t){if(this.pointerFlowEdges.has(e)){const s=this.pointerFlowEdges.get(e);return!!s&&s.includes(t)}return!1}printPointerFlowGraph(){ws.info("PointerFlowGraph Elements: ");for(let e of this.getPointerSet())ws.info("\t"+e.toString());ws.info("PointerFlowGraph Edges: ");for(let e of this.pointerFlowEdges.keys()){ws.info("\t"+e.toString());for(let t of this.getPointerFlowEdges(e))ws.info("\t\t"+t.toString())}}}const Is=h.getLogger();class Fs extends Ss{constructor(e){super(e),this.workList=[],this.reachableStmts=[],this.reachableMethods=[],this.pointerFlowGraph=new Cs,this.CHAtool=this.scene.scene.makeCallGraphCHA([])}loadCallGraph(e){this.processWorkList(e),this.pointerFlowGraph.printPointerFlowGraph()}processWorkList(e){for(this.addReachable(e);0!=this.workList.length;){let e=this.workList.shift(),t=e.getPointer(),s=e.getPointerTarget(),i=t.getIdentifier();if(Is.info("[processWorkList] process work item: "+i.getName()+" -> "+s.getType()),Is.info("\t"+s.getLocation()+" "+s.getType()),null!=this.pointerFlowGraph.getPointerSetElement(i).getPointerTarget(s))continue;let n=this.pointerFlowGraph.proPagate(i,s);for(let e of n)this.workList.push(e);i instanceof te&&this.processInstanceInvokeStmt(i,s)}}resolveCall(e,t){throw new Error("Method not implemented.")}preProcessMethod(e){throw new Error("Method not implemented.")}addReachable(e){for(let t of e){if(Is.info("[addReachable] processing method: "+t.toString()),ms(t,this.reachableMethods,((e,t)=>e.toString()===t.toString())))continue;this.reachableMethods.push(t);let e=this.scene.getMethod(t);if(null==e)continue;let s=e.getCfg().getStmts();this.reachableStmts.push(...s);for(let i of s)if(i instanceof ye){let s=i.getLeftOp(),n=i.getRightOp();if(n instanceof z){let e=n.getType(),r=new xs(e,xs.genLocation(t,i));Is.info("\t[addReachable] find new expr in method, add workList: "+s.getName()+" -> "+r.getType()),this.workList.push(new Ts(this.pointerFlowGraph.getPointerSetElement(s),r))}else if(n instanceof te)Is.info("\t[addReachable] find assign expr in method, add pointer flow edge: "+n.getName()+" -> "+s.getType()),this.addEdgeIntoPointerFlowGraph(this.pointerFlowGraph.getPointerSetElement(n),this.pointerFlowGraph.getPointerSetElement(s));else if(n instanceof G){let t=this.scene.getMethod(n.getMethodSignature());if(null==t)continue;this.addReachable([t.getSignature()]),this.processInvokePointerFlow(e,t,i)}}else if(i instanceof xe){let t=i.getInvokeExpr();if(t instanceof G){let s=this.scene.getMethod(t.getMethodSignature());if(null==s)continue;this.addReachable([t.getMethodSignature()]),this.processInvokePointerFlow(e,s,i)}}}}processInstanceInvokeStmt(e,t){var s;Is.info("[processInvokeStmt] process identifier: "+e.getName());for(let i of this.reachableStmts)if(i.containsInvokeExpr()){let n=i.getInvokeExpr();if(void 0===n)continue;if(n instanceof _){if(e!=n.getBase())continue}else if(n instanceof G)continue;let r=null===(s=i.getCfg())||void 0===s?void 0:s.getDeclaringMethod(),o=this.getSpecificCallTarget(n,t);if(null==o)continue;let a=o.getSignature();Is.info("\t[processInvokeStmt] get specific call target: "+a.toString()+", from stmt: "+i.toString());let l=o.getThisInstance();if(null==l)continue;Is.info("\t[processInvokeStmt] add pointer to call target this instance: "+t.getType()),this.workList.push(new Ts(this.pointerFlowGraph.getPointerSetElement(l),t)),this.processInvokePointerFlow(r,o,i)}}processInvokePointerFlow(e,t,s){if(ms(t.getSignature(),this.getCall(e.getSignature()),((e,t)=>e.toString()===t.toString())))return;let i=s.getInvokeExpr();if(null==i)return;let n=e.getSignature(),r=t.getSignature();this.addCall(n,r),this.addMethod(n),this.addReachable([r]);let o=i.getArgs(),a=t.getParameterInstances();Is.info("[processInvokeStmt] add pointer flow edges for invoke stmt parameter");for(let e=0;e<o.length;e++)this.addEdgeIntoPointerFlowGraph(this.pointerFlowGraph.getPointerSetElement(o[e]),this.pointerFlowGraph.getPointerSetElement(a[e]));if(s instanceof ye){let e=t.getReturnValues();for(let t of e)this.addEdgeIntoPointerFlowGraph(this.pointerFlowGraph.getPointerSetElement(t),this.pointerFlowGraph.getPointerSetElement(s.getLeftOp()))}}addEdgeIntoPointerFlowGraph(e,t){let s=this.pointerFlowGraph.addPointerFlowEdge(e,t);for(let e of s)this.workList.push(e)}getSpecificCallTarget(e,t){let s=t.getType();if(!(s instanceof I))return null;let i=this.scene.getClass(s.getClassSignature());if(null==i)return Is.error("can not resolve classtype: "+s.toString()),null;const n=i.getMethods();for(let t of n)if(t.getSignature().toString()===e.getMethodSignature().toString())return t;return null}}const As=h.getLogger();class Es{constructor(e,t,s,i){this.projectName=e,this.project_dir=t,this.sdkName=s,this.sdk_dir=i}}class bs{constructor(){this.configJsonPath="",this.targetProjectName="",this.targetProjectDirectory="",this.ohosSdkPath="",this.kitSdkPath="",this.systemSdkPath="",this.otherSdkMap=new Map,this.sdkFiles=[],this.sdkFilesMap=new Map,this.projectFiles=[],this.logPath="./out/ArkAnalyzer.log"}buildFromJson(e){this.configJsonPath=e,this.genConfig(),this.getAllFiles()}buildFromProjectDir(e){this.targetProjectDirectory=e,this.targetProjectName=n.basename(e),h.configure(this.logPath,l.ERROR),this.getAllFiles()}buildFromIde(e,t,s){this.targetProjectName=e,this.targetProjectDirectory=t,this.ohosSdkPath=s||"",h.configure(this.logPath,l.ERROR),this.getAllFiles()}buildFromIdeSingle(e,t,s,i){this.targetProjectName=e,this.targetProjectDirectory=t,this.projectFiles.push(s),this.logPath=i,h.configure(this.logPath,l.ERROR)}genConfig(){if(!o.existsSync(this.configJsonPath))throw new Error(`Your configJsonPath: "${this.configJsonPath}" is not exist.`);{let e=JSON.parse(o.readFileSync(this.configJsonPath,"utf8"));this.targetProjectName=e.targetProjectName,this.targetProjectDirectory=e.targetProjectDirectory,this.logPath=e.logPath,h.configure(this.logPath,l.ERROR),this.ohosSdkPath=e.ohosSdkPath,this.kitSdkPath=e.kitSdkPath,this.systemSdkPath=e.systemSdkPath;let t=[];for(let s of e.otherSdks)t.push(JSON.parse(JSON.stringify(s)));t.forEach((e=>{e.name&&e.path&&this.otherSdkMap.set(e.name,e.path)}))}}getAllFiles(){if(!this.targetProjectDirectory)throw new Error("TargetProjectDirectory is wrong.");{let e=Ps(this.targetProjectDirectory,"\\.ts$");this.projectFiles.push(...e)}if(this.ohosSdkPath){let e=Ps(this.ohosSdkPath,"\\.d\\.ts$");this.sdkFiles.push(...e),this.sdkFilesMap.set(e,"ohos")}if(this.kitSdkPath){let e=Ps(this.kitSdkPath,"\\.d\\.ts$");this.sdkFiles.push(...e),this.sdkFilesMap.set(e,"kit")}if(this.systemSdkPath){let e=Ps(this.systemSdkPath,"\\.d\\.ts$");this.sdkFiles.push(...e),this.sdkFilesMap.set(e,"system")}0!=this.otherSdkMap.size&&this.otherSdkMap.forEach(((e,t)=>{let s=Ps(e,"\\.d\\.ts$");this.sdkFiles.push(...s),this.sdkFilesMap.set(s,t)}))}getTargetProjectName(){return this.targetProjectName}getTargetProjectDirectory(){return this.targetProjectDirectory}getProjectFiles(){return this.projectFiles}getSdkFiles(){return this.sdkFiles}getSdkFilesMap(){return this.sdkFilesMap}getOhosSdkPath(){return this.ohosSdkPath}getKitSdkPath(){return this.kitSdkPath}getSystemSdkPath(){return this.systemSdkPath}getOtherSdkMap(){return this.otherSdkMap}getLogPath(){return this.logPath}}function Ps(e,t,s=[]){let i=new RegExp(t);if(!o.existsSync(e))return As.info("Input directory is not exist: ",e),s;const r=o.realpathSync(e);return o.readdirSync(r).forEach((e=>{const a=n.resolve(r,e);o.statSync(a).isDirectory()?Ps(a,t,s):i.test(a)&&s.push(a)})),s}const Ds=h.getLogger();class vs{constructor(){this.currScope=new Ms([],0),this.scopeChain=[this.currScope],this.currVisibleValues=[...this.currScope.values]}getCurrVisibleValues(){return this.currVisibleValues}getScopeChain(){return this.scopeChain}updateIntoScope(e){let t="";t=e instanceof Nt?"block: "+e.toString():e.getName(),Ds.info("---- into scope:{",t,"}");let s=[];e instanceof hs||e instanceof is?s=this.getVisibleValuesIntoFileOrNameSpace(e):e instanceof Jt?s=this.getVisibleValuesIntoClass(e):e instanceof $t?s=this.getVisibleValuesIntoMethod(e):e instanceof Nt&&(s=this.getVisibleValuesIntoBasicBlock(e));const i=this.getTargetDepth(e);this.addScope(s,i,e)}updateOutScope(){const e=this.currScope.arkModel;let t="";t=e instanceof Nt?"block: "+e.toString():e.getName(),Ds.info("---- out scope:{",t,"}");let s=this.currScope.depth;if(e instanceof Nt){e.getSuccessors().length>1&&(s+=1)}this.deleteScope(s)}deleteScope(e){if(e>this.currScope.depth)return;let t=0,s=0;for(let i=this.scopeChain.length-1;i>=0&&!(this.scopeChain[i].depth<e);i--)s+=1,t+=this.scopeChain[i].values.length;this.scopeChain.splice(this.scopeChain.length-s,s)[0],this.currScope=this.scopeChain[this.scopeChain.length-1];const i=this.currVisibleValues.length;this.currVisibleValues.splice(i-t,t)}addScope(e,t,s){const i=new Ms(e,t,s);this.currScope=i,this.scopeChain.push(this.currScope),this.currVisibleValues.push(...this.currScope.values)}getTargetDepth(e){const t=this.currScope.depth,s=this.currScope.arkModel;let i=t+1;if(e instanceof Nt){i=e.getPredecessors().length<=1?t+1:t}else(e instanceof hs&&s instanceof hs||e instanceof is&&s instanceof is||e instanceof Jt&&s instanceof Jt||e instanceof $t&&s instanceof $t)&&(i=t);return i}getVisibleValuesIntoFileOrNameSpace(e){return[]}getVisibleValuesIntoClass(e){const t=[],s=e.getFields(),i=e.getSignature();for(const e of s)if(e.getModifiers().has("StaticKeyword")){const s=new ae(e.getSignature());t.push(s)}else{const s=new oe(new te("this",new I(i)),e.getSignature());t.push(s)}return t}getVisibleValuesIntoMethod(e){return[]}getVisibleValuesIntoBasicBlock(e){const t=[];for(const s of e.getStmts())s instanceof ye&&t.push(s.getLeftOp());return t}}class Ms{constructor(e,t=-1,s=null){this.values=e,this.depth=t,this.arkModel=s}}const Os=h.getLogger();class Bs{constructor(e){this.projectName="",this.projectFiles=[],this.arkFiles=[],this.targetProjectArkFilesMap=new Map,this.sdkArkFilestMap=new Map,this.extendedClasses=new Map,this.globalImportInfos=[],this.sdkFilesProjectMap=new Map,this.visibleValue=new vs,this.allClasses=[],this.allMethods=[],this.inferTypesDone=!1,this.projectName=e.getTargetProjectName(),this.projectFiles=e.getProjectFiles(),this.realProjectDir=o.realpathSync(e.getTargetProjectDirectory()),this.ohosSdkPath=e.getOhosSdkPath(),this.kitSdkPath=e.getKitSdkPath(),this.systemSdkPath=e.getSystemSdkPath(),this.sdkFilesProjectMap=e.getSdkFilesMap(),this.otherSdkMap=e.getOtherSdkMap(),this.configImportSdkPrefix(),this.genArkFiles(),this.collectProjectImportInfos()}configImportSdkPrefix(){this.ohosSdkPath&&at("ohos",n.relative(this.realProjectDir,this.ohosSdkPath)),this.kitSdkPath&&at("kit",n.relative(this.realProjectDir,this.kitSdkPath)),this.systemSdkPath&&at("system",n.relative(this.realProjectDir,this.systemSdkPath)),this.otherSdkMap&&this.otherSdkMap.forEach(((e,t)=>{at(t,n.relative(this.realProjectDir,e))}))}genArkFiles(){this.sdkFilesProjectMap.forEach(((e,t)=>{if(0!=t.length){const s=e;let i="";if("ohos"==s)i=o.realpathSync(this.ohosSdkPath);else if("kit"==s)i=o.realpathSync(this.kitSdkPath);else if("system"==s)i=o.realpathSync(this.systemSdkPath);else{let t=this.otherSdkMap.get(e);t&&(i=o.realpathSync(t))}t.forEach((e=>{Os.info("=== parse file:",e);let t=new hs;t.setProjectName(s),cs(e,i,t),t.setScene(this),this.sdkArkFilestMap.set(t.getFileSignature().toString(),t)}))}})),this.projectFiles.forEach((e=>{Os.info("=== parse file:",e);let t=new hs;t.setProjectName(this.projectName),cs(e,this.realProjectDir,t),t.setScene(this),this.arkFiles.push(t),this.targetProjectArkFilesMap.set(t.getFileSignature().toString(),t)}))}getFile(e){return this.arkFiles.find((t=>t.getFileSignature().toString()==e.toString()))||null}getFiles(){return this.arkFiles}getTargetProjectArkFilesMap(){return this.targetProjectArkFilesMap}getSdkArkFilestMap(){return this.sdkArkFilestMap}getNamespace(e){let t=null;if(e instanceof De){let s=e.getDeclaringFileSignature();this.arkFiles.forEach((i=>{i.getFileSignature().toString()==s.toString()&&(t=i.getNamespaceAllTheFile(e))}))}else this.getAllNamespacesUnderTargetProject().forEach((s=>{s.getNamespaceSignature().toString()==e&&(t=s)}));return t}getClass(e){let t=null;if(e instanceof ve){let s=e.getDeclaringFileSignature();this.arkFiles.forEach((i=>{i.getFileSignature().toString()==s.toString()&&(t=i.getClassAllTheFile(e))}))}else this.getAllClassesUnderTargetProject().forEach((s=>{s.getSignature().toString()==e&&(t=s)}));return t}getMethod(e){let t=null;if(e instanceof Be){let s=e.getDeclaringClassSignature().getDeclaringFileSignature();this.arkFiles.forEach((i=>{i.getFileSignature().toString()==s.toString()&&(t=i.getMethodAllTheFile(e))}))}else this.getAllMethodsUnderTargetProject().forEach((s=>{s.getSignature().toString()==e&&(t=s)}));return t}getAllNamespacesUnderTargetProject(){let e=[];return this.arkFiles.forEach((t=>{e.push(...t.getAllNamespacesUnderThisFile())})),e}getAllClassesUnderTargetProject(){return 0==this.allClasses.length&&this.arkFiles.forEach((e=>{this.allClasses.push(...e.getAllClassesUnderThisFile())})),this.allClasses}getAllMethodsUnderTargetProject(){return 0==this.allMethods.length&&this.arkFiles.forEach((e=>{this.allMethods.push(...e.getAllMethodsUnderThisFile())})),this.allMethods}hasMainMethod(){return!1}getEntryPoints(){return[]}getVisibleValue(){return this.visibleValue}makeCallGraphCHA(e){let t;return t=new ks(this),t.loadCallGraph(e),t}makeCallGraphRTA(e){let t;return t=new ys(this),t.loadCallGraph(e),t}makeCallGraphVPA(e){let t;return t=new Fs(this),t.loadCallGraph(e),t}inferTypes(){if(this.inferTypesDone)return;const e=new ze(this);for(let t of this.arkFiles)for(let s of t.getClasses())for(let t of s.getMethods())e.inferTypeInMethod(t);this.genExtendedClasses(),this.inferTypesDone=!0}inferSimpleTypes(){const e=new ze(this);for(let t of this.arkFiles)for(let s of t.getClasses())for(let t of s.getMethods())e.inferSimpleTypeInMethod(t)}collectProjectImportInfos(){this.arkFiles.forEach((e=>{e.getImportInfos().forEach((e=>{this.globalImportInfos.push(e)}))}))}genExtendedClasses(){this.getAllClassesUnderTargetProject().forEach((e=>{let t=e.getSuperClassName(),s=null;s=_e.getClassWithNameFromClass(t,e),null!=s&&(e.setSuperClass(s),s.addExtendedClass(e))}))}}export{St as ASTree,Ss as AbstractCallGraph,W as AbstractExpr,re as AbstractFieldRef,K as AbstractInvokeExpr,ie as AbstractRef,b as AliasType,M as AnnotationNamespaceType,v as AnnotationType,O as AnnotationTypeQueryType,d as AnyType,ne as ArkArrayRef,ye as ArkAssignStmt,H as ArkBinopExpr,bt as ArkBody,Y as ArkCastExpr,ce as ArkCaughtExceptionRef,Jt as ArkClass,Q as ArkConditionExpr,Ae as ArkDeleteStmt,$e as ArkField,hs as ArkFile,Te as ArkGotoStmt,Ne as ArkIfStmt,oe as ArkInstanceFieldRef,_ as ArkInstanceInvokeExpr,J as ArkInstanceOfExpr,xe as ArkInvokeStmt,X as ArkLengthExpr,$t as ArkMethod,is as ArkNamespace,$ as ArkNewArrayExpr,z as ArkNewExpr,Ie as ArkNopStmt,le as ArkParameterRef,Z as ArkPhiExpr,we as ArkReturnStmt,Ce as ArkReturnVoidStmt,ae as ArkStaticFieldRef,G as ArkStaticInvokeExpr,Fe as ArkSwitchStmt,he as ArkThisRef,Ee as ArkThrowStmt,q as ArkTypeOfExpr,ee as ArkUnopExpr,A as ArrayObjectType,F as ArrayType,It as BUILDIN_CONTAINER_COMPONENT,Nt as BasicBlock,f as BooleanType,C as CallableType,Tt as Cfg,P as ClassAliasType,ks as ClassHierarchyAnalysisAlgorithm,ve as ClassSignature,I as ClassType,Es as Config,kt as Constant,yt as DefUseChain,wt as DominanceFinder,Ct as DominanceTree,Me as FieldSignature,Pe as FileSignature,Le as InterfaceSignature,Se as LineColPosition,me as LinePosition,x as LiteralType,te as Local,Be as MethodSignature,Oe as MethodSubSignature,De as NamespaceSignature,w as NeverType,mt as NodeA,k as NullType,m as NumberType,fe as Position,p as PrimitiveType,ys as RapidTypeAnalysisAlgorithm,Bs as Scene,bs as SceneConfig,ke as Stmt,S as StringType,E as TupleType,c as Type,D as TypeLiteralType,g as UnclearReferenceType,y as UndefinedType,N as UnionType,u as UnknownType,xt as ValueTag,Fs as VariablePointerAnalysisAlogorithm,Et as ViewTree,At as ViewTreeNode,T as VoidType,zt as arkMethodNodeKind,cs as buildArkFileFromFile,Ht as buildArkMethodFromArkClass,ns as buildArkNamespace,Xt as buildDefaultArkClassFromArkFile,Yt as buildDefaultArkClassFromArkNamespace,Zt as buildNormalArkClassFromArkFile,es as buildNormalArkClassFromArkNamespace,Qt as buildNormalArkMethodFromAstNode,Re as classSignatureCompare,Ue as fieldSignatureCompare,We as fileSignatureCompare,Ke as genSignature4ImportClause,Ve as methodSignatureCompare,je as methodSubSignatureCompare,ls as notStmtOrExprKind};
//# sourceMappingURL=bundle.js.map
